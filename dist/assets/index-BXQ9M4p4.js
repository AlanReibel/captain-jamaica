var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{p as i}from"./phaser-C2_wa_Fb.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const s={flyingRobot:{animations:{Idle:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:32,frameHeight:38,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:32,frameHeight:32,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:-1}},fly:!0,speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=t.cameras.main.worldView,a=s.x+30,h=s.x+s.width-30,r=Phaser.Math.Distance.BetweenPoints(i,e)<=50,n=i.y-i.height/2;e.move(e.focusTo),e.x<a&&(e.focusTo="right"),e.x>h&&(e.focusTo="left"),(e.y<s.y+30||e.y>s.y+s.height-30)&&(e.setVelocityY(0),e.movingDirectionY="none"),i.x-e.x<20&&i.x-e.x>-20&&!e.attackDone&&e.y<n&&"up"!==e.movingDirectionY&&(e.movingDirectionY="down",e.setVelocityY(120),e.setVelocityX(0)),r&&!e.attackDone&&(e.stop(),e.attack()),e.attackDone?e.y-e.startPosition.y>10&&e.y-e.startPosition.y<-10?(e.movingDirectionY="up",e.setVelocityY(-80)):e.attackDone=!1:e.y>=n&&e.y>e.startPosition.y&&(e.movingDirectionY="up",e.setVelocityY(-80))}},weelRobot:{animations:{Idle:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:32,frameHeight:24,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:-1}},speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e)<=200,a=Phaser.Math.CeilTo(i.x)-Phaser.Math.CeilTo(e.x);if(s){let t=i.x<e.x?"left":"right";a<10&&a>-10?(e.stop(),e.attack()):e.move(t)}else e.stop()}},basebolHitter:{animations:{Idle:{frameWidth:38,frameHeight:34,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:38,frameHeight:34,frames:6,frameRate:12,repeat:0},Attack:{frameWidth:38,frameHeight:34,frames:6,frameRate:12,repeat:0},Hurt:{frameWidth:38,frameHeight:34,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:38,frameHeight:34,frames:6,frameRate:12,repeat:-1}},fly:!1,speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=200,h=Phaser.Math.CeilTo(i.x)-Phaser.Math.CeilTo(e.x);if(a){let t=i.x<e.x?"left":"right";h<10&&h>-10?e.stop():s<=40?(e.stop(),e.attack()):e.move(t)}else e.stop()}},mutantDog:{animations:{Idle:{frameWidth:38,frameHeight:40,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:48,frameHeight:40,frames:6,frameRate:12,repeat:0},Attack:{frameWidth:38,frameHeight:40,frames:9,frameRate:12,repeat:0},Hurt:{frameWidth:38,frameHeight:40,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:38,frameHeight:40,frames:6,frameRate:12,repeat:-1}},fly:!1,speed:50,health:100,bulletImage:"ball2",bulletDamage:10,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=150,h=Phaser.Math.CeilTo(i.x)-Phaser.Math.CeilTo(e.x);if(e.focusTo=h<0?"left":"right",a)if(s>=150){let t=i.x<e.x?"left":"right";h<=40||h>=-40?e.stop():e.move(t)}else e.stop(),e.attack(),e.fire(t)}},brainTank:{animations:{Idle:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:30,frameHeight:34,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1}},fly:!1,speed:30,health:150,bulletImage:"ball1",bulletDamage:20,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=200,h=Phaser.Math.CeilTo(i.x)-Phaser.Math.CeilTo(e.x);if(e.focusTo=h<0?"left":"right",a)if(s>=150){let t=i.x<e.x?"left":"right";e.move(t)}else e.stop(),e.attack(),e.fire(t)}}};class a extends Phaser.Physics.Arcade.Sprite{constructor(t,i,a,h){super(t,i,a,`${h}-Idle`),e(this,"invulnerable",!1),e(this,"state","idle"),e(this,"focusTo","right"),e(this,"bulletFired",!1),e(this,"bullets"),e(this,"bulletImage"),e(this,"bulletDamage"),e(this,"startPosition"),e(this,"attackDone",!1),e(this,"movingDirectionX"),e(this,"movingDirectionY"),this.name=h,t.add.existing(this),t.physics.add.existing(this),this.startPosition={x:this.x,y:this.y},this.anims.play(`${h}-Idle`),this.scene=t,this.health=s[h].health||100,this.speed=s[h].speed||100,this.behavior=s[h].behavior,this.bulletImage=s[h].bulletImage,this.bulletDamage=s[h].bulletDamage,this.setCollideWorldBounds(!0),this.bullets=this.scene.physics.add.group()}update(){"hurt"!==this.state&&"dying"!==this.state&&this.behavior(this.scene,this)}attack(){if("attacking"!==this.state){this.attackDone=!1,this.state="attacking";let t="left"===this.focusTo;this.anims.play(`${this.name}-Attack`,!0).setFlipX(t),this.once("animationcomplete",(()=>{this.attackDone=!0,this.state="idle"}))}}fire(t){if(!this.bulletFired){let e="right"===this.focusTo?1:-1;this.bulletFired=!0;let i=t.physics.add.image(this.x,this.y,this.bulletImage);i.damage=this.bulletDamage,this.bullets.add(i),i.setVelocityX(500*e),i.body.setAllowGravity(!1),t.time.delayedCall(800,(()=>{this.bulletFired=!1}))}}hurt(t){console.log("enemy hurt",t),"hurt"===this.state||this.invulnerable||(this.state="hurt",this.invulnerable=!0,this.anims.play(`${this.name}-Hurt`,!0),this.takeDamage(t),this.once("animationcomplete",(()=>{this.invulnerable=!1,this.state="idle"})))}move(t=this.focusTo){"attacking"!==this.state&&(this.movingDirectionX=t,this.turn=t!==this.focusTo,this.focusTo=t,this.state="walk","left"===t&&(this.setVelocityX(-this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!0)),"right"===t&&(this.setVelocityX(this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!1)))}stop(){if("attacking"!==this.state&&"hurt"!==this.state&&"dying"!==this.state){this.setVelocityX(0),this.state="idle";let t="left"===this.focusTo;this.anims.play(`${this.name}-Idle`,!0).setFlipX(t)}}takeDamage(t){this.health-=t,this.health<=0&&this.die()}die(){"dying"!==this.state&&(this.state="dying",this.anims.play(`${this.name}-Death`,!0),this.once("animationcomplete",(()=>{this.destroy(),console.log(`${this.name} death`)})))}static loadResources(t){for(const[e,i]of Object.entries(s))for(const[s,a]of Object.entries(i.animations))t.load.spritesheet(`${e}-${s}`,`assets/sprites/enemies/${e}/${s}.png`,{frameWidth:a.frameWidth,frameHeight:a.frameHeight});t.load.image("ball1","assets/sprites/enemies/bullets/Ball1.png"),t.load.image("ball2","assets/sprites/enemies/bullets/Ball2.png")}static createAnimations(t,e){for(const[i,a]of Object.entries(s[e].animations))t.anims.create({key:`${e}-${i}`,frames:t.anims.generateFrameNumbers(`${e}-${i}`,{start:0,end:a.frames-1}),frameRate:a.frameRate,repeat:a.repeat})}}class h extends i.Scene{constructor(){super("Boot")}preload(){this.loadAudios(),this.loadImages(),this.loadSpriteSheets(),this.loadTileMaps()}create(){this.scene.start("Preloader")}loadAudios(){this.load.audio("bitest","assets/sounds/bitest.mp3"),this.load.audio("laser","assets/sounds/laser2.mp3"),this.load.audio("punch","assets/sounds/punch3.mp3"),this.load.audio("boomerang","assets/sounds/boomerang2.mp3"),this.load.audio("die","assets/sounds/explosion.mp3")}loadSpriteSheets(){this.captainSprites(),this.enemiesSprites()}loadImages(){this.load.image("background","assets/orange-skyline.png"),this.load.image("bullet","assets/sprites/captain/bullet.png"),this.load.image("bg1","assets/background/1.png"),this.load.image("bg2","assets/background/2.png"),this.load.image("bg3","assets/background/3.png"),this.load.image("bg4","assets/background/4.png"),this.load.image("bg5","assets/background/5.png")}loadTileMaps(){this.load.image("tilemapImage","assets/tiles/Tileset.png"),this.load.image("tilemapImage2","assets/tiles/greenTiles2.png"),this.load.image("objectsTilemap","assets/tiles/objects.png"),this.load.tilemapTiledJSON("tilemapJson","assets/tiles/world.json")}captainSprites(){this.load.spritesheet("captain-idle","assets/sprites/captain/idle.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-run","assets/sprites/captain/run.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-fight","assets/sprites/captain/fight.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("shield-throw","assets/sprites/captain/shield-throw.png",{frameWidth:75,frameHeight:64}),this.load.spritesheet("shield-fly","assets/sprites/captain/shield-fly.png",{frameWidth:64,frameHeight:40}),this.load.spritesheet("special","assets/sprites/captain/special.png",{frameWidth:128,frameHeight:92}),this.load.spritesheet("whip","assets/sprites/captain/whip.png",{frameWidth:135,frameHeight:64}),this.load.aseprite({key:"shot",textureURL:"assets/sprites/captain/shot.png",atlasURL:"assets/sprites/captain/shot.json"})}enemiesSprites(){a.loadResources(this)}}class r extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets")}create(){this.scene.start("MainMenu")}}class n extends i.Scene{constructor(){super("MainMenu")}create(){this.add.image(this.game.config.width/2,this.game.config.height/2,"background"),this.add.text(this.game.config.width/2,this.game.config.height/2,"Captain Jamaica Prototype",{fontFamily:"Arial Black",fontSize:19,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(this.game.config.width/2,this.game.config.height/2+50,"Click / Touch to Start",{fontFamily:"Arial Black",fontSize:10,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("Game")}))}}class o extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"bullet"),this.scene=t,this.scene.physics.world.enable(this),this.scene.add.existing(this),this.setCollideWorldBounds(!0)}fire(t,e,i){let s="right"===i?1:-1,a="left"===i;this.bulletFlash(t,e),this.body.reset(t,e),this.body.setAllowGravity(!1),this.setActive(!0),this.setVisible(!0),this.setScale(.5),this.setVelocityX(1e3*s),this.setFlipX(a)}update(){this.y<0&&(this.setActive(!1),this.setVisible(!1))}animationComplete(t,e){this.destroy()}bulletFlash(t,e){let i=this.scene.add.graphics();i.fillStyle(16777215,1),i.fillCircle(t,e,10),i.postFX.addBloom(16777215,1,1,1,2),this.scene.tweens.add({targets:i,x:t,y:e,scale:0,opacity:0,duration:100,onComplete:()=>{i.destroy()}})}}class l extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s,a){super(t,i,s,a),e(this,"state","idle"),e(this,"blockedJump",!1),e(this,"velocity",100),e(this,"shield"),e(this,"shieldThrown",!1),e(this,"shieldCached",!0),e(this,"health",100),e(this,"vulnerable",!0),e(this,"movingDirection","right"),e(this,"focusTo","right"),e(this,"blockedMovement",!1),e(this,"bulletFired",!1),e(this,"bullets"),e(this,"fightEnds",!0),e(this,"blockedFight",!1),this.scene=t,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setDepth(1).setBounce(.2).setCollideWorldBounds(!0).setScale(.6),this.createAnimations(),this.anims.play("idle",!0),this.punchSound=this.scene.sound.add("punch"),this.originalWidth=this.width,this.originalHeight=this.height,this.originalX=this.x,this.originalY=this.y,this.setMaxVelocity(100,400),this.laserSound=t.sound.add("laser"),this.laserSound.setVolume(.4),this.bullets=this.scene.physics.add.group({classType:o,runChildUpdate:!0,allowGravity:!1})}createAnimations(){this.scene.anims.create({key:"idle",frames:this.scene.anims.generateFrameNumbers("captain-idle",{start:0,end:6}),frameRate:12,repeat:-1}),this.scene.anims.create({key:"run",frames:this.scene.anims.generateFrameNumbers("captain-run",{start:0,end:9}),frameRate:12,repeat:-1}),this.scene.anims.create({key:"punch",frames:this.scene.anims.generateFrameNumbers("captain-fight",{start:1,end:3}),frameRate:12,repeat:0}),this.scene.anims.create({key:"kick",frames:this.scene.anims.generateFrameNumbers("captain-fight",{start:4,end:7}),frameRate:12,repeat:0}),this.scene.anims.create({key:"shield",frames:this.scene.anims.generateFrameNumbers("captain-fight",{start:8,end:11}),frameRate:12,repeat:0}),this.scene.anims.create({key:"throw",frames:this.scene.anims.generateFrameNumbers("shield-throw",{start:0,end:5}),frameRate:12,repeat:0}),this.scene.anims.create({key:"catch",frames:this.scene.anims.generateFrameNumbers("shield-throw",{start:12,end:15}),frameRate:12,repeat:0}),this.scene.anims.create({key:"fly",frames:this.scene.anims.generateFrameNumbers("shield-fly",{start:0,end:7}),frameRate:12,repeat:0}),this.scene.anims.create({key:"whip",frames:this.scene.anims.generateFrameNumbers("whip",{start:0,end:20}),frameRate:15,repeat:0}),this.scene.anims.create({key:"special",frames:this.scene.anims.generateFrameNumbers("special",{start:11,end:56}),frameRate:18,repeat:0}),this.scene.anims.create({key:"block",frames:this.scene.anims.generateFrameNumbers("special",{start:0,end:10}),frameRate:12,repeat:0}),this.scene.anims.createFromAseprite("shot");let t=["punch","punch2","kick","shield","fly","catch","burst","jumpKick"];this.on("animationcomplete",((e,i)=>{t.includes(e.key)&&(this.scene.fightEnds=!0)}))}resetSprite(){this.setVelocityX(0),this.setSize(this.originalWidth,this.originalHeight),this.setPosition(this.originalX,this.y),this.setOffset(0,0),this.setScale(.6),this.scene.cameras.main.startFollow(this,!0,1,.1,0,0)}idle(){this.setVelocityX(0),"throw"!==this.state&&"jump"!==this.state&&"jumpKick"!==this.state&&"kick"!==this.state&&"shield"!==this.state&&"catch"!==this.state&&"whip"!==this.state&&"special"!==this.state&&"burst"!==this.state&&(this.anims.play("idle",!0),this.state="idle")}move(t){if(!this.blockedMovement){this.originalX=this.x,this.originalY=this.y,this.movingDirection=t,this.focusTo=t;let e="left"===t?-1:1,i="left"===t;console.log("state",this.state),"whip"!==this.state&&this.setVelocityX(this.velocity*e),"jump"!==this.state&&(this.anims.play("run",!0).setFlipX(i),this.state="running")}}takeDamage(t){this.health-=t}throwShield(){this.shield=this.scene.physics.add.sprite(this.x,this.y,"shield-fly"),this.shield.setScale(.6),this.bullets.add(this.shield),this.blockedMovement=!0;let t=this.scene.sound.add("boomerang");this.scene.time.delayedCall(400,(()=>{t.play()})),this.anims.play("throw",!0),this.state="throw",this.scene.time.delayedCall(375,(()=>{let t={x:"right"==this.focusTo?this.x+this.width/2:this.x-this.width/2,y:this.y};this.shield.setPosition(t.x,t.y),this.shield.anims.play("fly",!0);let e="right"==this.focusTo?t.x+150:t.x-150;this.scene.tweens.add({targets:this.shield,x:e,y:t.y,duration:333,ease:"Power1",onComplete:()=>{this.flyBackTween()}})})),this.shield.on("animationcomplete-fly",((t,e)=>{"fly"===t.key&&(this.scene.fightEnds=!0)}))}flyBackTween(){this.scene.tweens.add({targets:this.shield,x:this.x,y:this.y,duration:333,ease:"Power1",onComplete:()=>{this.shield.setVisible(!1),this.shieldThrown=!1,this.shieldCached=!0,this.anims.play("catch",!0)}}),this.on("animationcomplete-catch",((t,e)=>{this.shield.destroy(),this.state="idle",this.fightEnds=!0,this.blockedMovement=!1}))}fireBullet(t){let e="right"==this.focusTo?.5*this.width:-.5*this.width,i=t.player.x+e,s=this.bullets.get(i,t.player.y);s?(s.fire(i,t.player.y,this.focusTo),this.laserSound.play()):console.log("No hay balas disponibles")}burst(){this.resetSprite(),this.setVelocityX(0),this.blockedMovement=!0,this.blockedFight=!0,this.fightEnds=!1,this.anims.play("burst",!0),this.state="burst",this.on("animationcomplete-burst",((t,e)=>{this.resetSprite(),this.state="idle",this.fightEnds=!0,this.blockedMovement=!1}))}kick(){this.blockedFight=!0,this.fightEnds=!1,this.anims.play("kick",!0),this.state="kick",this.punchSound.play(),this.on("animationcomplete-kick",((t,e)=>{this.state="idle",this.fightEnds=!0}))}punch(){this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch",!0),this.state="punch",this.punchSound.play(),this.on("animationcomplete-punch",((t,e)=>{this.state="idle",this.fightEnds=!0}))}punch2(){this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch2",!0),this.state="punch2",this.punchSound.play(),this.on("animationcomplete-punch2",((t,e)=>{this.state="idle",this.fightEnds=!0}))}whip(){this.setVelocityX(0);let t="right"===this.focusTo?1:-1;this.vulnerable=!1,this.blockedMovement=!0,this.state="whip",this.blockedFight=!0,this.fightEnds=!1,this.scene.cameras.main.stopFollow(),this.setPosition(this.originalX+22*t,this.y),this.setOffset(0,5),this.setScale(.58),this.anims.play("whip",!0),this.punchSound.play(),this.scene.time.delayedCall(740,(()=>{this.setSize(135,64)})),this.on("animationcomplete-whip",((t,e)=>{this.resetSprite(),this.state="idle",this.fightEnds=!0,this.blockedMovement=!1,this.vulnerable=!0}))}shieldAttack(){this.setVelocityX(0),this.blockedFight=!0,this.fightEnds=!1,this.shieldCached&&!this.shieldThrown&&(this.shieldThrown=!0,this.throwShield())}shieldHit(){"up"!==this.movingDirection&&"down"!==this.movingDirection&&(this.blockedFight=!0,this.fightEnds=!1,this.anims.play("shield",!0),this.state="shield",this.scene.time.delayedCall(100,(()=>{this.punchSound.play()})),this.on("animationcomplete-shield",((t,e)=>{this.scene.time.delayedCall(200,(()=>{this.state="idle",this.fightEnds=!0}))})))}handleJump(){this.blockedJump=!0,this.movingDirection="up",this.setVelocityY(-400),this.body.setGravityY(400),this.anims.play("jump"),"running"===this.state?this.state="runningJump":(this.state="jump",this.on("animationcomplete-jump",((t,e)=>{this.anims.play("idle")})))}jumpKick(){console.log("jumpKick",this.anims),this.fightEnds=!1,this.blockedFight=!0,this.anims.play("jumpKick",!0),this.state="jumpKick",this.on("animationcomplete-jumpKick",((t,e)=>{this.state="idle",this.fightEnds=!0}))}special(){this.vulnerable=!1;let t=this.x,e=this.y,i=this.width,s=this.height,a="left"===this.focusTo?-1:1,h="left"===this.focusTo;this.setVelocityX(0),this.state="special",this.setVisible(!1);let r=this.scene.physics.add.sprite(t+3,e-s/2+3,"special");r.setFlipX(h),r.anims.play("special",!0),this.scene.tweens.add({targets:r,x:t+50*a,y:e-80,duration:2055.55,ease:"Power1",onComplete:()=>{this.scene.tweens.add({targets:r,x:t+50*a,y:e-27,duration:200,ease:"Power1"})}}),r.body.setAllowGravity(!1),r.setScale(.95),this.scene.time.delayedCall(2300,(()=>{this.state="specialExplosion",this.body.setSize(128,64)})),this.scene.time.delayedCall(2555.55,(()=>{r.destroy(),this.setPosition(t+50*a,e),this.body.setSize(i,s),this.setVisible(!0),this.state="idle",this.vulnerable=!0}))}land(){this.anims.play("land",!0),this.on("animationcomplete-land",((t,e)=>{this.state="idle",this.idle(),this.movingDirection=this.focusTo}))}runCombo(t){switch(t){case"combo1":this.punch2();break;case"combo2":this.burst();break;case"combo3":this.kick()}}}class d{constructor(t){this.scene=t,this.cursors=t.input.keyboard.createCursorKeys(),this.wKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.aKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.sKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.dKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.qKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.eKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.fKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F),this.buttons={A:!1,B:!1,X:!1,Y:!1},this.holding={A:!1,B:!1,X:!1,Y:!1},this.holdingTime=1e3,this.maxComboTime=1e3,this.isMobile=!0,this.isMobile=this.isMobileDevice()||this.isTouchDevice(),this.createCombos(),this.isMobile&&(this.scene.game.scene.start("UIScene",{inputHandler:this}),this.resizeGame({width:this.scene.scale.width,height:this.scene.scale.height}),this.scene.scale.updateCenter())}isFightActionPressed(){return this.qKey.isDown||this.eKey.isDown||this.fKey.isDown||this.cursors.space.isDown||this.buttons.A||this.buttons.B||this.buttons.X||this.buttons.Y}isFightActionLeaved(){return this.cursors.space.isUp&&this.qKey.isUp&&this.fKey.isUp&&this.eKey.isUp&&!this.buttons.A&&!this.buttons.B&&!this.buttons.X&&!this.buttons.Y}isJumpLeaved(){let t=!this.joystickKeys||this.joystickKeys.up.isUp;return this.wKey.isUp&&this.cursors.up.isUp&&t}isJumpKeyPressed(){var t;return this.cursors.up.isDown||this.wKey.isDown||(null==(t=this.joystickKeys)?void 0:t.up.isDown)}isMobileDevice(){const t=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(t)||/iPad|iPhone|iPod/.test(t)&&!window.MSStream}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}resizeGame({width:t,height:e}){const i=4/3;let s,a,h;t/e>i?(a=e,s=e*i):(s=t,a=t/i),this.width=s,this.height=a,h=Math.min(s/this.scene.game.config.width,a/this.scene.game.config.height),this.scene.cameras.main.setZoom(h),this.scene.cameras.main.setViewport((t-s)/2,(e-a)/2,s,a),this.scene.cameras.main.setBounds(0,0,this.scene.game.config.width,this.scene.game.config.height)}setButtonState(t,e){this.buttons[t]=e}setJoystickCursor(t){const e=this.scene.plugins.get("rexVirtualJoystick");e?(this.joystick=e.add(this.scene,t),this.joystickKeys=this.joystick.createCursorKeys()):console.error("Plugin rexVirtualJoystick no encontrado")}createCombos(){this.scene.input.keyboard.createCombo("QE",{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.createCombo("EE",{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.createCombo("QQ",{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.on("keycombomatch",(t=>{81===t.keyCodes[0]&&69===t.keyCodes[1]&&this.runCombo("combo1"),69===t.keyCodes[0]&&69===t.keyCodes[1]&&this.runCombo("combo2"),81===t.keyCodes[0]&&81===t.keyCodes[1]&&this.runCombo("combo3"),console.log("Combo",t.keyCodes)}))}runCombo(t){this.scene.player.runCombo(t)}}class c extends i.Scene{constructor(){super("Game"),e(this,"player"),e(this,"inputHandler"),e(this,"score",0),e(this,"textScore"),e(this,"lives",3),e(this,"textLives"),e(this,"gameOver",!1),e(this,"map"),e(this,"enemies"),e(this,"groundLayer"),e(this,"healthBar")}create(){this.gameOver=!1,this.player=new l(this,100,400,"captain-idle"),this.inputHandler=new d(this),this.addBackground(),console.log("game scene",this),this.playMusic(),this.addTileMaps(),this.createCamera(),this.createEnemies()}update(){if(0==this.player.body.velocity.x&&this.player.body.blocked.down&&(this.player.movingDirection="none"),"jump"===this.player.state&&this.player.body.velocity.y>=0&&(this.player.movingDirection="down",this.inputHandler.isFightActionPressed()&&!this.player.blockedFight&&this.player.jumpKick()),"jump"===this.player.state&&this.player.body.blocked.down&&this.player.land(),this.inputHandler.isFightActionLeaved()&&(this.player.blockedFight=!1),this.inputHandler.isJumpLeaved()&&(this.player.blockedJump=!1),this.inputHandler.isFightActionPressed()&&!this.player.blockedFight&&this.handleFightActions(),this.inputHandler.cursors.space.isDown){let t=this.inputHandler.cursors.space.getDuration();t-this.inputHandler.holdingTime<=20&&t-this.inputHandler.holdingTime>=0?(this.inputHandler.holding.X=!0,this.inputHandler.buttons.X=!0):(this.inputHandler.holding.X=!1,this.inputHandler.buttons.X=!1)}if(this.inputHandler.eKey.isDown){let t=this.inputHandler.eKey.getDuration();t-this.inputHandler.holdingTime<=20&&t-this.inputHandler.holdingTime>=0?(this.inputHandler.holding.B=!0,this.inputHandler.buttons.B=!0):(this.inputHandler.holding.B=!1,this.inputHandler.buttons.B=!1)}if(this.inputHandler.buttons.X&&this.inputHandler.holding.X&&(this.inputHandler.holding.X=!1,this.inputHandler.buttons.X=!1,this.player.shieldAttack(),this.player.blockedFight=!0),this.inputHandler.buttons.B&&this.inputHandler.holding.B&&(this.inputHandler.buttons.B=!1,this.inputHandler.holding.B=!1,this.player.special(),this.player.blockedFight=!0),this.player.fightEnds&&this.handleMovement(),this.inputHandler.isJumpKeyPressed()&&this.player.body.blocked.down&&!this.player.blockedJump&&this.player.handleJump(),this.gameOver&&this.scene.start("GameOver"),"burst"===this.player.anims.currentAnim.key){let t=this.player.anims.currentFrame;t.index>=3&&t.index%2==1?this.player.bulletFired||(this.player.fireBullet(this),this.player.bulletFired=!0):this.player.bulletFired=!1}else this.player.bulletFired=!1;this.landEnemies&&this.landEnemies.children.iterate((t=>{t.update()})),this.flyingEnemies&&this.flyingEnemies.children.iterate((t=>{t.update()}))}handleFightActions(){this.inputHandler.qKey.isDown||this.inputHandler.buttons.A?this.player.punch():this.inputHandler.eKey.isDown||this.inputHandler.buttons.B?this.player.whip():this.inputHandler.fKey.isDown||this.inputHandler.buttons.Y?this.player.shieldAttack():(this.inputHandler.cursors.space.isDown||this.inputHandler.buttons.X)&&this.player.shieldHit()}hitEnemy(t,e){let i=this.sound.add("die");t.hurt(e),i.play()}handleMovement(){var t,e;this.inputHandler.cursors.left.isDown||this.inputHandler.aKey.isDown||(null==(t=this.inputHandler.joystickKeys)?void 0:t.left.isDown)?(this.player.move("left"),this.moveBackground(-1)):this.inputHandler.cursors.right.isDown||this.inputHandler.dKey.isDown||(null==(e=this.inputHandler.joystickKeys)?void 0:e.right.isDown)?(this.player.move("right"),this.moveBackground(1)):this.player.idle()}createEnemies(){this.landEnemies=this.physics.add.group(),this.flyingEnemies=this.physics.add.group({allowGravity:!1}),["flyingRobot","weelRobot","basebolHitter","mutantDog","brainTank"].forEach((t=>{a.createAnimations(this,t)})),this.map.getObjectLayer("enemies").objects.forEach((t=>{let e=new a(this,t.x,t.y,t.name);"flyingRobot"===t.name?this.flyingEnemies.add(e):(this.landEnemies.add(e),this.physics.add.overlap(e.bullets,this.player,this.playerFired,null,this))})),this.physics.add.overlap(this.player,this.landEnemies,this.handleBodyCollision,null,this),this.physics.add.collider(this.player.bullets,this.landEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.greenTilesLayer,this.landEnemies,null,null,this),this.physics.add.overlap(this.player,this.flyingEnemies,this.handleBodyCollision,null,this),this.physics.add.collider(this.player.bullets,this.flyingEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.greenTilesLayer,this.flyingEnemies,null,null,this)}playerFired(t,e){this.player.vulnerable&&"special"!==this.player.state&&(this.player.vulnerable=!1,this.player.takeDamage(e.damage),this.healthbarUpdate(),e.destroy()),this.time.delayedCall(1e3,(()=>{this.player.vulnerable=!0}))}handleBulletCollision(t,e){this.hitEnemy(e,20),"bullet"===t.texture.key&&t.destroy()}handleHitCollision(t,e){this.hitEnemy(e)}handleBodyCollision(t,e){"punch"!==t.state&&"kick"!==t.state&&"whip"!==t.state&&"specialExplosion"!==t.state&&"shield"!==t.state||this.hitEnemy(e,{punch:20,kick:30,shield:50,whip:100,specialExplosion:150}[t.state]),"attacking"===e.state&&this.player.vulnerable&&(this.player.takeDamage(10),this.player.vulnerable=!1,this.healthbarUpdate(),this.time.delayedCall(800,(()=>{this.player.vulnerable=!0})))}showGuideText(){let t={fontFamily:"Arial Black",fontSize:15,color:"#000000",align:"center"};this.add.text(20,20,"WSAD or arrow keys to move",t),this.add.text(20,40,"Q key for punch",t),this.add.text(20,60,"E key for kick",t),this.add.text(20,80,"SPACE key for shield attack",t),this.add.text(20,100,"F key for shield throw",t)}playMusic(){let t=this.sound.add("bitest");t.play(),t.setLoop(!0)}addBackground(){let t=this.game.config.width,e=this.game.config.height,i=this.inputHandler.width||t,s=this.inputHandler.height||e,a=t===i?0:(i-t)/2,h=e===s?0:(s-e)/2;this.bg1=this.add.tileSprite(a,h,i,s,"bg1").setScrollFactor(0).setOrigin(0,0),this.bg2=this.add.tileSprite(a,h,i,s,"bg2").setScrollFactor(0).setOrigin(0,0),this.bg3=this.add.tileSprite(a,h,i,s,"bg3").setScrollFactor(0).setOrigin(0,0),this.bg4=this.add.tileSprite(a,h,i,s,"bg4").setScrollFactor(0).setOrigin(0,0),this.bg5=this.add.tileSprite(a,h,i,s,"bg5").setScrollFactor(0).setOrigin(0,0),this.addHealthBar(a,h)}moveBackground(t){let e=this.cameras.main.scrollX/20;this.bg1.tilePositionX=.2*e,this.bg2.tilePositionX=.5*e,this.bg3.tilePositionX=1*e,this.bg4.tilePositionX=2*e,this.bg5.tilePositionX=3*e}createCamera(){this.physics.world.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels).startFollow(this.player,!0,1,.1,0,0).setFollowOffset(0,-50)}addTileMaps(){this.map=this.make.tilemap({key:"tilemapJson"});const t=this.map.addTilesetImage("Tileset","tilemapImage");this.groundLayer=this.map.createLayer("ground",t);const e=this.map.addTilesetImage("greenTiles2","tilemapImage2");this.greenTilesLayer=this.map.createLayer("greenPlatforms",e);const i=this.map.addTilesetImage("objects","objectsTilemap");this.map.createLayer("trees",i),this.groundLayer.setCollisionByProperty({collider:!0}),this.physics.add.collider(this.player,this.groundLayer),this.greenTilesLayer.setDepth(0).setCollisionByProperty({collider:!0}),this.physics.add.collider(this.player,this.greenTilesLayer)}addHealthBar(t,e){this.uiContainer=this.add.container(t,e),this.uiContainer.setScrollFactor(0);let i=this.player.health,s=this.add.graphics();s.fillStyle(16711680,1).fillRect(10,10,i,15),this.healthBar=this.add.graphics(),this.healthBar.fillStyle(65280,1).fillRect(10,10,i,15),this.uiContainer.add(s),this.uiContainer.add(this.healthBar)}healthbarUpdate(){this.healthBar.clear(),this.healthBar.fillStyle(65280,1).fillRect(10,10,this.player.health,15),0===this.player.health&&(this.gameOver=!0)}}class u extends Phaser.Scene{constructor(){super({key:"UIScene",transparent:!0}),this.width,this.height,this.isPortrait,this.comboSequences=[],this.comboTimeout=null,this.comboList=[{sequence:["A","B"],action:"combo1"},{sequence:["B","B"],action:"combo2"},{sequence:["A","A"],action:"combo3"}]}init(t){this.inputHandler=t.inputHandler}create(){console.log("UI scene",this),this.width=this.scale.parentSize.width,this.height=this.scale.parentSize.height,this.isPortrait=this.width<this.height,this.scale.setGameSize(this.width,this.height),this.addVirtualJoystick(),this.addVirtualButtons()}addVirtualJoystick(){const t=this.isPortrait?.06*this.width:.1*this.width,e=this.isPortrait?(this.width-2*t)/4:100,i=this.isPortrait?e+t:e+t/4,s=this.height-e-t,a={x:i,y:s,radius:e,base:this.add.circle(i,s,e,8947848).setAlpha(.5),thumb:this.add.circle(i,s,e/2,13421772).setAlpha(.8),dir:"8dir",fixed:!0,enable:!0};this.inputHandler.setJoystickCursor(a)}addVirtualButtons(){const t=Math.min(30,.06*this.width),e={x:this.width-4*t,y:this.isPortrait?this.height-5*t:this.height/2+2*t};[{key:"A",x:e.x,y:e.y+2*t},{key:"B",x:e.x+2*t,y:e.y},{key:"X",x:e.x-2*t,y:e.y},{key:"Y",x:e.x,y:e.y-2*t}].forEach((e=>{this.add.circle(e.x,e.y,t).setStrokeStyle(2,16711680).setInteractive().on("pointerdown",(()=>this.onButtonDown(e.key))).on("pointerup",(()=>this.onButtonUp(e.key))),this.add.text(e.x,e.y,e.key,{fontFamily:"Arial Black",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5)}))}handleResize(t){t.width,t.height,this.scene.restart()}onButtonDown(t){this.inputHandler.setButtonState(t,!0),this.recordKeyPress(t),this.time.delayedCall(this.inputHandler.holdingTime,(()=>{this.inputHandler.buttons[t]&&(this.inputHandler.holding[t]=!0,console.log("holded",this.inputHandler.holding))}))}onButtonUp(t){this.inputHandler.setButtonState(t,!1),this.inputHandler.holding[t]=!1}recordKeyPress(t){this.comboTimeout&&clearTimeout(this.comboTimeout),this.comboSequences.push(t),this.checkCombo(),this.comboTimeout=setTimeout((()=>{this.comboSequences=[]}),this.inputHandler.maxComboTime)}checkCombo(){for(let t of this.comboList)if(this.isComboMatch(t.sequence)){this.inputHandler.runCombo(t.action),this.comboSequences=[];break}}isComboMatch(t){if(this.comboSequences.length<t.length)return!1;const e=this.comboSequences.slice(-t.length);return t.every(((t,i)=>t===e[i]))}}class m extends i.Scene{constructor(){super("GameOver")}create(){this.cameras.main.setBackgroundColor(16711680),this.add.image(this.game.config.width/2,this.game.config.height/2,"background").setAlpha(.5),this.add.text(this.game.config.width/2,this.game.config.height/2,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}const p=Phaser.Input.Keyboard.Key,y=Phaser.Input.Keyboard.KeyCodes;class g{constructor(t){this.cursorKeys={up:new p(t,y.UP),down:new p(t,y.DOWN),left:new p(t,y.LEFT),right:new p(t,y.RIGHT)},this.noKeyDown=!0}shutdown(t){for(var e in this.cursorKeys)this.cursorKeys[e].destroy();this.cursorKeys=void 0}destroy(t){shutdown(t)}createCursorKeys(){return this.cursorKeys}setKeyState(t,e){var i=this.cursorKeys[t];return i.enabled?(e&&(this.noKeyDown=!1),i.isDown!==e&&(f.timeStamp=Date.now(),f.keyCode=i.keyCode,e?i.onDown(f):i.onUp(f)),this):this}clearAllKeysState(){for(var t in this.noKeyDown=!0,this.cursorKeys)this.setKeyState(t,!1);return this}getKeyState(t){return this.cursorKeys[t]}get upKeyDown(){return this.cursorKeys.up.isDown}get downKeyDown(){return this.cursorKeys.down.isDown}get leftKeyDown(){return this.cursorKeys.left.isDown}get rightKeyDown(){return this.cursorKeys.right.isDown}get anyKeyDown(){return!this.noKeyDown}}var f={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0},b=180/Math.PI;const v={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var w={};const k=Phaser.Utils.Objects.GetValue,x=Phaser.Math.Distance.Between,C=Phaser.Math.Angle.Between;class E extends g{constructor(t,e){super(t),this.resetFromJSON(e)}resetFromJSON(t){null==this.start&&(this.start={x:0,y:0}),null==this.end&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(k(t,"enable",!0)),this.setMode(k(t,"dir","8dir")),this.setDistanceThreshold(k(t,"forceMin",16));var e=k(t,"start.x",null),i=k(t,"start.y",null),s=k(t,"end.x",null),a=k(t,"end.y",null);return this.setVector(e,i,s,a),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(t){return"string"==typeof t&&(t=v[t]),this.dirMode=t,this}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.clearVector(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(t){return t<0&&(t=0),this.forceMin=t,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(t,e,i,s){if(!this.enable)return this;if(null===t)return this.clearVector(),this;if(void 0===i&&(i=t,t=0,s=e,e=0),this.start.x=t,this.start.y=e,this.end.x=i,this.end.y=s,this.forceMin>0&&this.force<this.forceMin)return this.clearVector(),this;this.noKeyDown=!0;var a=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=w),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i}(this.angle,this.dirMode,!0);for(var h in a)this.setKeyState(h,a[h]);return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return x(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return C(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return this.rotation*b}get octant(){var t=0;return this.rightKeyDown?t=this.downKeyDown?45:0:this.downKeyDown?t=this.leftKeyDown?135:90:this.leftKeyDown?t=this.upKeyDown?225:180:this.upKeyDown&&(t=this.rightKeyDown?315:270),t}}const K={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var D={};const S=Phaser.Utils.Objects.GetValue,H=Phaser.Geom.Circle,P=Phaser.Geom.Circle.Contains;class T extends E{constructor(t,e){var i=t.scene;super(i,e);var s=S(e,"eventEmitter",void 0),a=S(e,"EventEmitterClass",void 0);this.setEventEmitter(s,a),this.scene=i,this.mainCamera=i.sys.cameras.main,this.pointer=void 0,this.gameObject=t,this.radius=S(e,"radius",100),t.setInteractive(new H(t.displayOriginX,t.displayOriginY,this.radius),P),this.boot()}resetFromJSON(t){return super.resetFromJSON(t),this.pointer=void 0,this}toJSON(){var t=super.toJSON();return t.radius=this.radius,t}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(t){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||(this.pointer=void 0),super.enable=t,this}destroy(t){this.shutdown(t)}onParentDestroy(t,e){this.destroy(e)}onKeyDownStart(t){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.onKeyDown(t),this.emit("pointerdown",t))}onKeyDown(t){if(this.pointer===t){var e=function(t,e,i){var s=t.camera;return s?(void 0===i?i={}:!0===i&&(i=D),s===e?(i.x=t.worldX,i.y=t.worldY):s.getWorldPoint(t.x,t.y,i),i):null}(t,this.mainCamera,!0);if(e){var i=t.camera,s=this.gameObject,a=s.x,h=s.y;0===s.scrollFactorX&&(a+=i.scrollX),0===s.scrollFactorY&&(h+=i.scrollY),this.setVector(a,h,e.x,e.y),this.end.x=e.x,this.end.y=e.y,this.emit("update")}}}onKeyUp(t){this.pointer===t&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",t))}forceUpdate(){var t=this.pointer;return t&&t.isDown?(this.onKeyDown(t),this):this}}Object.assign(T.prototype,K);const F=Phaser.Utils.Objects.GetValue;class B{constructor(t,e){void 0===e&&(e={});var i=F(e,"eventEmitter",void 0),s=F(e,"EventEmitterClass",void 0);this.setEventEmitter(i,s),e.eventEmitter=this.getEventEmitter(),this.scene=t,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(F(e,"radius",100)),this.addBase(F(e,"base",void 0),e),this.addThumb(F(e,"thumb",void 0));var a=F(e,"x",0),h=F(e,"y",0);this.base.setPosition(a,h),this.thumb.setPosition(a,h),F(e,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(t,e){return this.x===t&&this.y===e||(this.x=t,this.y=e,this.forceUpdateThumb()),this}set x(t){this.x!==t&&(this.base.x=t,this.thumb.x=t)}set y(t){this.y!==t&&(this.base.y=t,this.thumb.y=t)}get x(){return this.base.x}get y(){return this.base.y}setVisible(t){return this.visible=t,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(t){this.base.visible=t,this.thumb.visible=t,this.enable=t}get enable(){return this.touchCursor.enable}set enable(t){this.touchCursor.setEnable(t)}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(t){return this.radius=t,this}addBase(t,e){return this.base&&this.base.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),void 0===e&&(e={}),e.eventEmitter=this.getEventEmitter(),this.touchCursor=new T(t,e),this.base=t,this}addThumb(t){return this.thumb&&this.thumb.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=t,this}setScrollFactor(t){return this.base.setScrollFactor(t),this.thumb.setScrollFactor(t),this}boot(){this.on("update",this.update,this)}update(){var t,e,i=this.touchCursor,s=i.dirMode;if(i.anyKeyDown)if(i.force>this.radius){var a=i.rotation;t=0!==s?Math.cos(a)*this.radius:0,e=1!==s?Math.sin(a)*this.radius:0}else t=0!==s?i.forceX:0,e=1!==s?i.forceY:0;else t=0,e=0;return this.thumb.x=this.base.x+t,this.thumb.y=this.base.y+e,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(B.prototype,K);class M extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t,e){return new B(t,e)}addVectorToCursorKeys(t){return new E(void 0,t)}}const A={type:Phaser.AUTO,width:400,height:300,parent:"game-container",fullscreenTarget:"game-container",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,physics:{default:"arcade",arcade:{gravity:{y:500}}},scene:[h,r,n,c,u,m],plugins:{global:[{key:"rexVirtualJoystick",plugin:M,start:!0}]}};new Phaser.Game(A);
