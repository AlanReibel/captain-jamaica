var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{p as i}from"./phaser-C2_wa_Fb.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class s extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("splash","assets/captain-splash.png"),this.loadIntroAudios(),this.loadIntroImages()}create(){this.input.once("pointerdown",(()=>{this.scene.start("Intro")})),this.addSkipButton()}loadIntroAudios(){this.load.audio("keySound1","assets/sounds/typewrite/key1.mp3"),this.load.audio("keySound2","assets/sounds/typewrite/key2.mp3"),this.load.audio("keySound3","assets/sounds/typewrite/key3.mp3"),this.load.audio("spaceSound","assets/sounds/typewrite/spaceBar.mp3"),this.load.audio("enterSound","assets/sounds/typewrite/newLine.mp3"),this.load.audio("introMusic","assets/sounds/intro.mp3")}loadIntroImages(){this.load.image("devasted-city","assets/intro/devasted-city.png"),this.load.image("shoting","assets/intro/shoting.png"),this.load.image("lying","assets/intro/lying.png"),this.load.image("elixir","assets/intro/elixir.png"),this.load.image("effects","assets/intro/effects.png"),this.load.image("reborn","assets/intro/reborn.png")}addSkipButton(){let t=this.game.config.width,e=this.game.config.height,i=this.add.text(t/2,e/2,"START",{fontFamily:"Courier",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.scene.start("Intro")}));this.tweens.add({targets:i,duration:500,y:e/2+1,yoyo:!0,repeat:-1})}}const a={flyingRobot:{animations:{Idle:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:32,frameHeight:38,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:32,frameHeight:32,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:32,frameHeight:32,frames:4,frameRate:12,repeat:-1}},damage:5,fly:!0,speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=t.cameras.main.worldView,a=s.x+30,n=s.x+s.width-30,h=s.y+30,r=s.y+s.health-30,o=Phaser.Math.Distance.BetweenPoints(i,e)<=50,l=i.y-i.height/2;e.move(e.focusTo),(e.x<a||e.body.blocked.left)&&(e.focusTo="right"),(e.x>n||e.body.blocked.right)&&(e.focusTo="left"),(e.y<h||e.y>r)&&(e.setVelocityY(0),e.movingDirectionY="none"),(i.x-e.x<20&&i.x-e.x>-20&&!e.attackDone&&e.y<l&&"up"!==e.movingDirectionY||e.body.blocked.up)&&(e.movingDirectionY="down",e.setVelocityY(120),e.setVelocityX(0)),o&&!e.attackDone&&(e.stop(),e.attack()),e.attackDone?e.y-e.startPosition.y>10&&e.y-e.startPosition.y<-10||e.body.blocked.down?(e.movingDirectionY="up",e.setVelocityY(-80)):e.attackDone=!1:(e.y>=l||e.body.blocked.down)&&(e.movingDirectionY="up",e.setVelocityY(-80))}},weelRobot:{animations:{Idle:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:32,frameHeight:24,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:32,frameHeight:24,frames:4,frameRate:12,repeat:-1}},damage:5,speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=200,n=i.x<e.x?"left":"right",h=i.focusTo===n?s<=20:s<=25,r=i.focusTo===n?s<=15:s<=20,o=i.x-e.x<=10&&i.x-e.x>=-10&&(i.y-e.y>=30||i.y-e.y<=-30);a&&!o?r?(n="left"===n?"right":"left",e.move(n)):h?(e.stop(),e.attack()):e.move(n):e.stop()}},basebolHitter:{animations:{Idle:{frameWidth:38,frameHeight:34,frames:4,frameRate:10,repeat:-1},Death:{frameWidth:38,frameHeight:34,frames:6,frameRate:8,repeat:0},Attack:{frameWidth:38,frameHeight:34,frames:6,frameRate:12,repeat:0},Hurt:{frameWidth:38,frameHeight:34,frames:2,frameRate:8,repeat:0},Walk:{frameWidth:38,frameHeight:34,frames:6,frameRate:10,repeat:-1}},damage:10,fly:!1,speed:50,health:100,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=200,n=i.x-e.x<=10&&i.x-e.x>=-10&&(i.y-e.y>=30||i.y-e.y<=-30);if(a&&!n){let t=i.x<e.x?"left":"right";s<=20?(e.stop(),e.attack()):e.move(t)}else e.stop()}},mutantDog:{animations:{Idle:{frameWidth:38,frameHeight:40,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:48,frameHeight:40,frames:6,frameRate:12,repeat:0},Attack:{frameWidth:38,frameHeight:40,frames:5,frameRate:9,repeat:0},Hurt:{frameWidth:38,frameHeight:40,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:38,frameHeight:40,frames:6,frameRate:12,repeat:-1}},shot:!0,fly:!1,speed:50,health:100,bulletImage:"ball2",bulletDamage:15,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=150,n=Phaser.Math.CeilTo(i.x)<Phaser.Math.CeilTo(e.x);if(e.focusTo=n?"left":"right",a)if(s<=30){let t=n?"right":"left";e.move(t)}else e.stop(),e.attack();else e.stop()}},brainTank:{animations:{Idle:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:30,frameHeight:34,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1}},shot:!0,fly:!1,speed:30,health:150,bulletImage:"ball1",bulletDamage:25,behavior:(t,e)=>{let i=t.player,s=Phaser.Math.Distance.BetweenPoints(i,e),a=s<=200,n=i.x<e.x?"left":"right",h=i.focusTo===n?s<=20:s<=25,r=i.focusTo===n?s<=15:s<=20;a?r?(n="left"===n?"right":"left",e.move(n)):h?(e.stop(),e.attack()):e.move(n):e.stop()}}};class n extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s,n){super(t,i,s,`${n}-Idle`),e(this,"invulnerable",!1),e(this,"state","idle"),e(this,"focusTo","right"),e(this,"bulletFired",!1),e(this,"bullets"),e(this,"bulletImage"),e(this,"bulletDamage"),e(this,"startPosition"),e(this,"attackDone",!1),e(this,"movingDirectionX"),e(this,"movingDirectionY"),e(this,"attackCounter",0),e(this,"nextAttackWait",2e3),e(this,"sounds",[]),this.name=n,t.add.existing(this),t.physics.add.existing(this),this.addSounds(),this.setDepth(5),this.setCollideWorldBounds(!0),this.startPosition={x:this.x,y:this.y},this.anims.play(`${n}-Idle`),this.scene=t,this.health=a[n].health||100,this.speed=a[n].speed||100,this.behavior=a[n].behavior,this.bulletImage=a[n].bulletImage,this.bulletDamage=a[n].bulletDamage,this.damage=a[n].damage,this.shot=a[n].shot,this.bullets=this.scene.physics.add.group(),this.bullets.setDepth(5)}update(){"hurt"!==this.state&&"dying"!==this.state&&this.behavior(this.scene,this)}attack(){if(this.attackCounter<2){if("attacking"!==this.state&&!this.attackDone){this.attackDone=!1,this.state="attacking";let t="left"===this.focusTo;this.anims.play(`${this.name}-Attack`,!0).setFlipX(t),this.shot?this.scene.time.delayedCall(200,(()=>{this.fire(this.scene),"mutantDog"==this.name&&this.scene.time.delayedCall(100,(()=>{this.fire(this.scene)}))})):this.sounds["enemy-punch"].play(),this.on(`animationcomplete-${this.name}-Attack`,(()=>{this.state="idle",this.scene.time.delayedCall(2e3,(()=>{this.attackDone=!0,this.attackCounter++}))}))}}else this.attackDone=!0,this.scene.time.delayedCall(this.nextAttackWait,(()=>{this.attackCounter=0,this.attackDone=!1}))}fire(t){if(!this.bulletFired){let e="right"===this.focusTo?1:-1;this.bulletFired=!0;let i=t.physics.add.image(this.x,this.y,this.bulletImage);i.damage=this.bulletDamage,this.bullets.add(i),i.setVelocityX(500*e),i.body.setAllowGravity(!1),this.sounds["enemy-shot"].play(),this.bulletFired=!1}}hurt(t){"hurt"===this.state||this.invulnerable||(this.state="hurt",this.invulnerable=!0,this.anims.play(`${this.name}-Hurt`,!0),this.takeDamage(t),this.once("animationcomplete",(()=>{this.invulnerable=!1,this.state="idle"})))}move(t=this.focusTo){"attacking"!==this.state&&(this.movingDirectionX=t,this.turn=t!==this.focusTo,this.focusTo=t,this.state="walk","left"===t&&(this.setVelocityX(-this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!0)),"right"===t&&(this.setVelocityX(this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!1)))}stop(){if("attacking"!==this.state&&"hurt"!==this.state&&"dying"!==this.state){this.setVelocityX(0),this.state="idle";let t="left"===this.focusTo;this.anims.play(`${this.name}-Idle`,!0).setFlipX(t)}}takeDamage(t){this.health-=t,this.health<=0&&this.die()}die(){"dying"!==this.state&&(this.state="dying",this.anims.play(`${this.name}-Death`,!0),this.once("animationcomplete",(()=>{this.sounds["enemy-die"].play(),this.destroy()})))}static loadResources(t){for(const[e,i]of Object.entries(a))for(const[s,a]of Object.entries(i.animations))t.load.spritesheet(`${e}-${s}`,`sprites/enemies/${e}/${s}.png`,{frameWidth:a.frameWidth,frameHeight:a.frameHeight});t.load.image("ball1","sprites/enemies/bullets/Ball1.png"),t.load.image("ball2","sprites/enemies/bullets/Ball2.png")}static createAnimations(t){for(const[e,i]of Object.entries(a))for(const[s,a]of Object.entries(i.animations))t.anims.create({key:`${e}-${s}`,frames:t.anims.generateFrameNumbers(`${e}-${s}`,{start:0,end:a.frames-1}),frameRate:a.frameRate,repeat:a.repeat})}addSounds(){["enemy-die","enemy-shot","enemy-punch"].forEach((t=>{this.sounds[t]=this.scene.sound.add(t)}))}}class h extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,a,n){super(t,e,i,s),this.scene=t,this.setFlipX(n),this.scene.physics.world.enable(this),this.scene.add.existing(this),this.setCollideWorldBounds(!0),this.potions=this.scene.physics.add.group(),this.PotionName=a,this.collected=!1,this.potionAmounts={health:25,power:50,ammo:10}}static createAnimations(t){t.anims.create({key:"chestOpen",frames:t.anims.generateFrameNumbers("chest",{start:0,end:3}),frameRate:8,repeat:0})}openBox(){this.anims.play("chestOpen"),this.on("animationcomplete-chestOpen",((t,e)=>{this.showPotion()}))}showPotion(){let t=this.scene.physics.add.sprite(this.x,this.y-15,this.PotionName);t.amount=this.potionAmounts[this.PotionName],t.name=this.PotionName,this.potions.add(t),t.body.setAllowGravity(!1),t.setDepth(3)}}class r extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"bullet"),this.scene=t,this.scene.physics.world.enable(this),this.scene.add.existing(this),this.setCollideWorldBounds(!0)}fire(t,e,i){let s="right"===i?1:-1,a="left"===i;this.bulletFlash(t,e),this.body.reset(t,e),this.body.setAllowGravity(!1),this.setActive(!0),this.setVisible(!0),this.setScale(.5),this.setVelocityX(1e3*s),this.setFlipX(a)}update(){this.y<0&&(this.setActive(!1),this.setVisible(!1))}animationComplete(t,e){this.destroy()}bulletFlash(t,e){let i=this.scene.add.graphics();i.fillStyle(16777215,1),i.fillCircle(t,e,10),i.postFX.addBloom(16777215,1,1,1,2),this.scene.tweens.add({targets:i,x:t,y:e,scale:0,opacity:0,duration:100,onComplete:()=>{i.destroy()}})}}class o extends Phaser.Physics.Arcade.Sprite{constructor(t,i,s,a){super(t,i,s,a),e(this,"state","idle"),e(this,"isJumping",!1),e(this,"blockedJump",!1),e(this,"velocity",100),e(this,"specialEnabled",!0),e(this,"ammoEnabled",!0),e(this,"shield"),e(this,"shieldThrown",!1),e(this,"shieldCached",!0),e(this,"health",100),e(this,"power",100),e(this,"vulnerable",!0),e(this,"movingDirection","right"),e(this,"focusTo","right"),e(this,"blockedMovement",!1),e(this,"bulletFired",!1),e(this,"bullets"),e(this,"fightEnds",!0),e(this,"blockedFight",!1),e(this,"originalWidth",26),e(this,"originalHeight",52),e(this,"sounds",[]),this.scene=t,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setDepth(5).setBounce(.2).setCollideWorldBounds(!0).setScale(.6).setSize(this.originalWidth,this.originalHeight).setOffset(24,6).setMaxVelocity(100,400),this.addSounds(),this.setFightAnimationState(),this.anims.play("idle",!0),this.originalX=this.x,this.originalY=this.y,this.bullets=this.scene.physics.add.group({classType:r,runChildUpdate:!0,allowGravity:!1})}static createAnimations(t){t.anims.create({key:"idle",frames:t.anims.generateFrameNumbers("captain-idle",{start:0,end:6}),frameRate:12,repeat:-1}),t.anims.create({key:"run",frames:t.anims.generateFrameNumbers("captain-run",{start:0,end:9}),frameRate:12,repeat:-1}),t.anims.create({key:"punch",frames:t.anims.generateFrameNumbers("captain-fight",{start:1,end:3}),frameRate:12,repeat:0}),t.anims.create({key:"kick",frames:t.anims.generateFrameNumbers("captain-fight",{start:4,end:7}),frameRate:12,repeat:0}),t.anims.create({key:"shield",frames:t.anims.generateFrameNumbers("captain-fight",{start:8,end:11}),frameRate:12,repeat:0}),t.anims.create({key:"throw",frames:t.anims.generateFrameNumbers("shield-throw",{start:0,end:5}),frameRate:12,repeat:0}),t.anims.create({key:"catch",frames:t.anims.generateFrameNumbers("shield-throw",{start:12,end:15}),frameRate:12,repeat:0}),t.anims.create({key:"fly",frames:t.anims.generateFrameNumbers("shield-fly",{start:0,end:7}),frameRate:12,repeat:0}),t.anims.create({key:"whip",frames:t.anims.generateFrameNumbers("whip",{start:0,end:19}),frameRate:15,repeat:0}),t.anims.create({key:"special",frames:t.anims.generateFrameNumbers("special",{start:0,end:45}),frameRate:18,repeat:0}),t.anims.create({key:"block",frames:t.anims.generateFrameNumbers("special",{start:0,end:10}),frameRate:12,repeat:0}),t.anims.createFromAseprite("shot")}setFightAnimationState(){let t=["punch","punch2","kick","shield","fly","catch","burst","jumpKick","whip","special"];this.on("animationcomplete",((e,i)=>{t.includes(e.key)&&(this.fightEnds=!0,this.vulnerable=!0,this.blockedMovement=!1,this.state="idle")}))}resetSprite(){let t="right"===this.focusTo?24:15;this.setVelocityX(0),this.setSize(this.originalWidth,this.originalHeight),this.setPosition(this.originalX,this.y),this.setOffset(t,7),this.setScale(.6),this.scene.cameras.main.startFollow(this,!0,1,.1,0,0)}idle(){this.setVelocityX(0),"throw"!==this.state&&"jump"!==this.state&&"jumpKick"!==this.state&&"kick"!==this.state&&"shield"!==this.state&&"catch"!==this.state&&"whip"!==this.state&&"special"!==this.state&&"landing"!==this.state&&"punch"!==this.state&&"burst"!==this.state&&(this.anims.play("idle",!0),this.state="idle")}move(t){if(!this.blockedMovement){this.originalX=this.x,this.originalY=this.y,this.movingDirection=t,this.focusTo=t;let e="left"===t?-1:1,i="left"===t,s="right"===this.focusTo?24:15;this.setVelocityX(this.velocity*e),this.setOffset(s,6),"jump"!==this.state&&"runningJump"!==this.state&&"landing"!==this.state&&(this.anims.play("run",!0).setFlipX(i),this.state="running")}}takeDamage(t){this.startBlink(3),this.sounds.hurt.setVolume(.5).play(),this.health-=t}throwShield(){this.shield=this.scene.physics.add.sprite(this.x,this.y,"shield-fly"),this.shield.setScale(.6),this.shield.setDepth(5),this.bullets.add(this.shield),this.blockedMovement=!0,this.anims.play("throw",!0),this.state="throw",this.scene.time.delayedCall(400,(()=>{this.sounds.boomerang.play()})),this.scene.time.delayedCall(375,(()=>{let t={x:"right"==this.focusTo?this.x+this.width/2:this.x-this.width/2,y:this.y};this.shield.setPosition(t.x,t.y),this.shield.anims.play("fly",!0);let e="right"==this.focusTo?t.x+150:t.x-150;this.scene.tweens.add({targets:this.shield,x:e,y:t.y,duration:333,ease:"Power1",onComplete:()=>{this.flyBackTween()}})}))}flyBackTween(){this.scene.tweens.add({targets:this.shield,x:this.x,y:this.y,duration:333,ease:"Power1",onComplete:()=>{this.shield.setVisible(!1),this.shieldThrown=!1,this.shieldCached=!0,this.shield.destroy(),this.anims.play("catch",!0)}}),this.on("animationcomplete-catch",((t,e)=>{this.state="idle",this.fightEnds=!0,this.blockedMovement=!1}))}fireBullet(t){let e="right"==this.focusTo?.5*this.width:-.5*this.width,i=t.player.x+e,s=this.bullets.get(i,t.player.y);s?(s.fire(i,t.player.y,this.focusTo),this.sounds["player-fire"].play()):console.log("No hay balas disponibles")}burst(){this.ammoEnabled?(this.resetSprite(),this.setVelocityX(0),this.blockedMovement=!0,this.blockedFight=!0,this.fightEnds=!1,this.anims.play("burst",!0),this.state="burst",this.on("animationcomplete-burst",((t,e)=>{this.resetSprite(),this.state="idle",this.fightEnds=!0,this.blockedMovement=!1,this.ammoEnabled=!1,this.scene.disableAmmoMarker()}))):(this.sounds.error.play(),this.scene.uiBlink(this.scene.ammoMarker))}kick(){"whip"!==this.state&&(this.blockedFight=!0,this.fightEnds=!1,this.anims.play("kick",!0),this.state="kick",this.sounds["pre-punch"].play(),this.on("animationcomplete-kick",((t,e)=>{this.state="idle",this.fightEnds=!0})))}punch(){"whip"!==this.state&&(this.resetSprite(),this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch"),this.state="punch",this.sounds["pre-punch"].play(),this.on("animationcomplete-punch",((t,e)=>{this.state="idle",this.fightEnds=!0})))}punch2(){"whip"!==this.state&&(this.resetSprite(),this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch2",!0),this.state="punch2",this.sounds["pre-punch"].play(),this.on("animationcomplete-punch2",((t,e)=>{this.state="idle",this.fightEnds=!0})))}whip(){if(!this.isJumping){let t="right"===this.focusTo?24:90,e="right"===this.focusTo?1:-1;this.blockedFight=!0,this.fightEnds=!1,this.vulnerable=!1,this.blockedMovement=!0,this.scene.cameras.main.stopFollow(),this.setVelocityX(0),this.anims.play("whip",!0),this.setPosition(this.originalX+22*e,this.y-1),this.setOffset(t,10),this.setScale(.58),this.scene.time.delayedCall(600,(()=>{"whip"===this.anims.currentAnim.key&&this.anims.isPlaying&&(this.sounds.whip.play(),this.state="whip")})),this.scene.time.delayedCall(740,(()=>{"whip"===this.state&&(this.setSize(135,64),this.power-=25,this.scene.powerbarUpdate())})),this.on("animationcomplete-whip",((t,e)=>{this.resetSprite(),this.blockedMovement=!1}))}}shieldAttack(){this.setVelocityX(0),this.blockedFight=!0,this.fightEnds=!1,this.shieldCached&&!this.shieldThrown&&(this.shieldThrown=!0,this.throwShield())}shieldHit(){this.resetSprite(),"up"!==this.movingDirection&&"down"!==this.movingDirection&&"throw"!==this.state&&(this.blockedFight=!0,this.fightEnds=!1,this.anims.play("shield",!0),this.state="shield",this.scene.time.delayedCall(100,(()=>{"shield"===this.state&&this.sounds["pre-punch"].play()})))}handleJump(){this.blockedJump||(this.resetSprite(),this.isJumping=!0,this.blockedJump=!0,this.blockedMovement=!1,this.fightEnds=!0,this.movingDirection="up",this.setVelocityY(-400),this.setGravityY(400),this.anims.play("jump"),this.sounds.jump.play(),"running"===this.state?this.state="runningJump":this.state="jump",this.on("animationcomplete-jump",((t,e)=>{this.state="idle",this.isJumping=!1})))}jumpKick(){this.fightEnds=!1,this.blockedFight=!0,this.anims.play("jumpKick",!0),this.sounds["pre-punch"].play(),this.state="jumpKick",this.on("animationcomplete-jumpKick",((t,e)=>{this.state="idle",this.fightEnds=!0}))}special(){if(!this.isJumping&&this.specialEnabled){this.fightEnds=!1,this.anims.stop(),this.state="special",this.specialEnabled=!1,this.scene.disableSpecialMarker(),this.scene.cameras.main.stopFollow(),this.vulnerable=!1;let t=this.x,e=this.y;this.width;let i=this.height,s="left"===this.focusTo?-1:1,a="left"===this.focusTo;this.sounds.special.play(),this.setVelocityX(0),this.setVisible(!1);let n=this.scene.physics.add.sprite(t+3,e-i/2+3,"special");n.setSize(this.originalWidth,this.originalHeight),n.setDepth(5),n.setFlipX(a),n.anims.play("special",!0),this.scene.tweens.add({targets:n,x:t+50*s,y:e-80,duration:2055.55,ease:"Power1",onComplete:()=>{this.scene.tweens.add({targets:n,x:t+50*s,y:e-27,duration:55.55,ease:"Power1"})}}),n.body.setAllowGravity(!1),n.setScale(.95),this.scene.time.delayedCall(2110,(()=>{"special"===this.state&&(console.log("this",this),n.setSize(n.width,n.height),this.state="specialExplosion",this.sounds.explosion.play(),this.body.setSize(128,64),this.scene.cameras.main.shake(100,.05))})),n.on("animationcomplete-special",(()=>{this.resetSprite(),this.setVisible(!0),this.state="idle",this.vulnerable=!0,this.fightEnds=!0,this.blockedMovement=!1,n.destroy(),this.setPosition(t+50*s,e+10),this.originalX=this.x,this.originalY=this.y}))}}land(){this.isJumping=!1,this.anims.play("land",!0),this.sounds.land.play(),this.state="landing",this.on("animationcomplete-land",((t,e)=>{this.state="idle",this.movingDirection=this.focusTo,this.blockedMovement=!1}))}runCombo(t){switch(t){case"combo1":this.punch2();break;case"combo2":this.burst();break;case"combo3":this.kick()}}addSounds(){["pre-punch","player-punch","player-fire","jump","land","hurt","shield","boomerang","whip","hit","special","explosion","chest","item","increase","error"].forEach((t=>{this.sounds[t]=this.scene.sound.add(t)}))}startBlink(t){this.scene.tweens.add({targets:this,alpha:.3,ease:"Linear",duration:200,yoyo:!0,repeat:t-1,onComplete:()=>{this.setAlpha(1)}})}}class l extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(0,0,"splash").setOrigin(0),this.addProgressBar()}preload(){this.load.setPath("assets"),this.loadAudios(),this.loadBgImages(),this.loadHudImages(),this.loadSpriteSheets(),this.loadTileMaps(),this.loadFXSprites()}create(){o.createAnimations(this),n.createAnimations(this),h.createAnimations(this),this.defineFXAnimations(),this.scene.start("MainMenu")}defineFXAnimations(){this.anims.create({key:"explosion1",frames:this.anims.generateFrameNumbers("explosion1",{start:0,end:11}),frameRate:24,repeat:0})}addProgressBar(){this.add.rectangle(200,150,300,31).setStrokeStyle(1,0);const t=this.add.rectangle(200,150,298,30,16181248);this.load.on("progress",(e=>{t.width=4+300*e}))}loadAudios(){["enemy-die","enemy-shot","enemy-punch","pre-punch","player-punch","player-fire","jump","land","hurt","shield","boomerang","whip","hit","special","explosion","chest","item","increase","error"].forEach((t=>{this.load.audio(t,`sounds/${t}.mp3`)})),this.load.audio("bitest","sounds/bitest.mp3")}loadSpriteSheets(){this.captainSprites(),this.enemiesSprites(),this.boxSprites()}loadBgImages(){this.load.image("bullet","sprites/captain/bullet.png"),this.load.image("bg1","background/1.png"),this.load.image("bg2","background/2.png"),this.load.image("bg3","background/3.png"),this.load.image("bg4","background/4.png"),this.load.image("bg5","background/5.png")}loadHudImages(){this.load.image("specialMarker","ui/special.png"),this.load.image("healthIcon","ui/health.png"),this.load.image("powerIcon","ui/power.png")}loadTileMaps(){this.load.image("tilemapImage2","tiles/greenTiles2.png"),this.load.image("objectsTilemap","tiles/newObjectSet.png"),this.load.tilemapTiledJSON("tilemapJson","tiles/world.json")}captainSprites(){this.load.spritesheet("captain-idle","sprites/captain/idle.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-run","sprites/captain/run.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-fight","sprites/captain/fight.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("shield-throw","sprites/captain/shield-throw.png",{frameWidth:75,frameHeight:64}),this.load.spritesheet("shield-fly","sprites/captain/shield-fly.png",{frameWidth:64,frameHeight:40}),this.load.spritesheet("special","sprites/captain/special.png",{frameWidth:128,frameHeight:92}),this.load.spritesheet("whip","sprites/captain/whip.png",{frameWidth:135,frameHeight:64}),this.load.aseprite({key:"shot",textureURL:"sprites/captain/shot.png",atlasURL:"sprites/captain/shot.json"})}enemiesSprites(){n.loadResources(this)}loadFXSprites(){this.load.spritesheet("explosion1","sprites/fx/explosion1.png",{frameWidth:25,frameHeight:24})}boxSprites(){this.load.spritesheet("chest","sprites/boxes/chest.png",{frameWidth:32,frameHeight:32}),this.load.image("power","sprites/boxes/power.png"),this.load.image("health","sprites/boxes/health.png"),this.load.image("ammo","sprites/boxes/ammo.png")}}class d extends i.Scene{constructor(){super("MainMenu")}init(t){this.inputHandler=t.inputHandler||!1}create(){let t,e,i,s=0,a=0,n=this.game.config.width,h=this.game.config.height,r=1;if(this.inputHandler){if(e=this.inputHandler.width||n,i=this.inputHandler.height||h,t=this.inputHandler.screenSize,r=e/n,s=n===e?0:(e-n)/2,a=h===i?0:(i-h)/2,this.inputHandler.isMobile)switch(this.inputHandler.orientation){case"portrait":s=0,a=(t.height-i)/2;break;case"landscape":s=(t.width-e)/2,a=0}console.log("bg size",{bgWidth:e,bgHeight:i}),console.log("game size",{gamewidth:n,gameheight:h})}console.log("main menu",this),this.add.image(s,a,"splash").setOrigin(0).setScale(r);let o=this.inputHandler.isMobile?s+e/2:s+n/2,l=this.inputHandler.isMobile?a+i/2:a+h/2;this.add.text(o,l,"Click / Touch to Start",{fontFamily:"Courier",fontSize:15,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.cameras.main.fadeOut(250,0,0,0),this.cameras.main.once("camerafadeoutcomplete",(function(t){this.scene.start("Game")}),this)}))}}class c{constructor(t){e(this,"buttons",{A:!1,B:!1,X:!1,Y:!1}),e(this,"holding",{A:!1,B:!1,X:!1,Y:!1}),e(this,"holdingTime",500),e(this,"maxComboTime",500),e(this,"isMobile",!0),e(this,"orientation"),e(this,"screeSize"),this.scene=t,this.cursors=t.input.keyboard.createCursorKeys(),this.wKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.aKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.sKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.dKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.qKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.eKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.fKey=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F),this.isMobile=this.isMobileDevice()||this.isTouchDevice(),this.createCombos(),this.isMobile&&(this.scene.game.scene.start("UIScene",{inputHandler:this}),this.resizeGame({width:this.scene.scale.width,height:this.scene.scale.height}),this.scene.scale.updateCenter())}isFightActionPressed(){return this.qKey.isDown||this.eKey.isDown||this.fKey.isDown||this.cursors.space.isDown||this.buttons.B||this.buttons.X||this.buttons.Y}isFightActionLeaved(){return this.cursors.space.isUp&&this.qKey.isUp&&this.fKey.isUp&&this.eKey.isUp&&!this.buttons.B&&!this.buttons.X&&!this.buttons.Y}isJumpLeaved(){return this.wKey.isUp&&this.cursors.up.isUp&&!this.buttons.A}isJumpKeyPressed(){return this.cursors.up.isDown||this.wKey.isDown||this.buttons.A}isMobileDevice(){const t=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(t)||/iPad|iPhone|iPod/.test(t)&&!window.MSStream}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}resizeGame({width:t,height:e}){this.screenSize={width:t,height:e};const i=4/3;let s,a,n;t/e>i?(a=e,s=e*i,this.orientation="landscape"):(s=t,a=t/i,this.orientation="portrait"),this.width=s,this.height=a,n=Math.min(s/this.scene.game.config.width,a/this.scene.game.config.height),this.scene.cameras.main.setZoom(n),this.scene.cameras.main.setViewport((t-s)/2,(e-a)/2,s,a),this.scene.cameras.main.setBounds(0,0,this.scene.game.config.width,this.scene.game.config.height)}setButtonState(t,e){this.buttons[t]=e}setJoystickCursor(t){const e=this.scene.plugins.get("rexVirtualJoystick");e?(this.joystick=e.add(this.scene,t),this.joystickKeys=this.joystick.createCursorKeys()):console.error("Plugin rexVirtualJoystick no encontrado")}createCombos(){let t=[Phaser.Input.Keyboard.KeyCodes.SPACE,Phaser.Input.Keyboard.KeyCodes.E],e=[Phaser.Input.Keyboard.KeyCodes.SPACE,Phaser.Input.Keyboard.KeyCodes.SPACE];this.scene.input.keyboard.createCombo(t,{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.createCombo(e,{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.on("keycombomatch",(t=>{32===t.keyCodes[0]&&69===t.keyCodes[1]&&this.runCombo("combo2"),32===t.keyCodes[0]&&32===t.keyCodes[1]&&this.runCombo("combo3")}))}runCombo(t){this.scene.player.runCombo(t)}}class p extends i.Scene{constructor(){super("Game"),e(this,"player"),e(this,"inputHandler"),e(this,"score",0),e(this,"textScore"),e(this,"lives",3),e(this,"textLives"),e(this,"gameOver",!1),e(this,"map"),e(this,"enemies"),e(this,"groundLayer"),e(this,"healthBar"),e(this,"guideIsOpen",!1),e(this,"boxesEnabled",{})}create(){this.cameras.main.fadeIn(200,0,0,0),this.gameOver=!1,this.player=new o(this,100,400,"captain-idle"),this.inputHandler=new c(this),this.addBackground(),this.playMusic(),this.addTileMaps(),this.createCamera(),this.createEnemies(),console.log("game scene",this);const t=document.querySelector("#guideButton");t.classList.add("visible"),t.addEventListener("pointerdown",(()=>{this.guideIsOpen?(this.scene.resume(),this.guideIsOpen=!1):(this.scene.pause(),this.guideIsOpen=!0)}))}update(){if(this.player.body.velocity.y<=-20?(this.player.movingDirection="down",this.inputHandler.isFightActionPressed()&&!this.player.blockedFight&&this.player.jumpKick()):0==this.player.body.velocity.x&&this.player.body.blocked.down&&(this.player.movingDirection="none"),"down"===this.player.movingDirection&&this.player.body.blocked.down&&this.player.fightEnds&&(this.player.land(),this.player.movingDirection="none"),this.inputHandler.isFightActionLeaved()&&this.player.fightEnds&&(this.player.blockedFight=!1),this.inputHandler.isJumpLeaved()&&(this.player.blockedJump=!1),this.inputHandler.isFightActionPressed()&&!this.player.blockedFight&&this.handleFightActions(),this.inputHandler.qKey.isDown){let t=this.inputHandler.qKey.getDuration();t-this.inputHandler.holdingTime<=20&&t-this.inputHandler.holdingTime>=0?(this.inputHandler.holding.X=!0,this.inputHandler.buttons.X=!0):(this.inputHandler.holding.X=!1,this.inputHandler.buttons.X=!1)}if(this.inputHandler.eKey.isDown){let t=this.inputHandler.eKey.getDuration();t-this.inputHandler.holdingTime<=20&&t-this.inputHandler.holdingTime>=0?(this.inputHandler.holding.Y=!0,this.inputHandler.buttons.Y=!0):(this.inputHandler.holding.Y=!1,this.inputHandler.buttons.Y=!1)}if(this.inputHandler.buttons.X&&this.inputHandler.holding.X&&(this.inputHandler.holding.X=!1,this.inputHandler.buttons.X=!1,this.player.shieldAttack(),this.player.blockedFight=!0),this.inputHandler.buttons.Y&&this.inputHandler.holding.Y&&(this.inputHandler.buttons.Y=!1,this.inputHandler.holding.Y=!1,this.player.special(),this.player.blockedFight=!0),this.player.fightEnds&&this.handleMovement(),this.inputHandler.isJumpKeyPressed()&&this.player.body.blocked.down&&!this.player.blockedJump&&this.player.handleJump(),this.gameOver&&(this.music.stop(),this.scene.start("GameOver",{inputHandler:this.inputHandler})),"burst"===this.player.anims.currentAnim.key){let t=this.player.anims.currentFrame;t.index>=3&&t.index%2==1?this.player.bulletFired||(this.player.fireBullet(this),this.player.bulletFired=!0):this.player.bulletFired=!1}else this.player.bulletFired=!1;this.landEnemies&&this.landEnemies.children.iterate((t=>{this.isEnemyInCameraView(t,this.cameras.main.worldView)&&t.update()})),this.flyingEnemies&&this.flyingEnemies.children.iterate((t=>{this.isEnemyInCameraView(t,this.cameras.main.worldView)&&t.update()})),this.player.x>3150&&this.player.y<70&&this.finishGame()}handleFightActions(){this.inputHandler.qKey.isDown||this.inputHandler.buttons.X?this.player.shieldHit():this.inputHandler.cursors.space.isDown||this.inputHandler.buttons.B?this.player.punch():(this.inputHandler.eKey.isDown||this.inputHandler.buttons.Y)&&(this.player.power>=50?this.player.whip():this.powerBarBlick())}hitEnemy(t,e){t.hurt(e)}handleMovement(){var t,e;this.inputHandler.cursors.left.isDown||this.inputHandler.aKey.isDown||(null==(t=this.inputHandler.joystickKeys)?void 0:t.left.isDown)?(this.player.move("left"),this.moveBackground(-1)):this.inputHandler.cursors.right.isDown||this.inputHandler.dKey.isDown||(null==(e=this.inputHandler.joystickKeys)?void 0:e.right.isDown)?(this.player.move("right"),this.moveBackground(1)):this.player.idle()}createEnemies(){this.landEnemies=this.physics.add.group(),this.flyingEnemies=this.physics.add.group({allowGravity:!1}),this.map.getObjectLayer("enemies").objects.forEach((t=>{let e=new n(this,t.x,t.y,t.name);"flyingRobot"===t.name?this.flyingEnemies.add(e):(this.landEnemies.add(e),this.physics.add.overlap(e.bullets,this.player,this.playerFired,null,this),this.physics.add.collider(e.bullets,this.greenTilesLayer,this.destroyBullet,null,this),this.physics.add.collider(e.bullets,this.walls,this.destroyBullet,null,this))})),this.physics.add.overlap(this.player,this.landEnemies,this.handleBodyCollision,null,this),this.physics.add.collider(this.greenTilesLayer,this.landEnemies,null,null,this),this.physics.add.collider(this.walls,this.landEnemies,null,null,this),this.physics.add.collider(this.landEnemies,this.landEnemies,null,null,this),this.physics.add.overlap(this.player,this.flyingEnemies,this.handleBodyCollision,null,this),this.physics.add.collider(this.greenTilesLayer,this.flyingEnemies,null,null,this),this.physics.add.collider(this.walls,this.flyingEnemies,null,null,this),this.physics.add.collider(this.player.bullets,this.landEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.player.bullets,this.flyingEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.player.bullets,this.greenTilesLayer,this.destroyBullet,null,this),this.physics.add.collider(this.player.bullets,this.walls,this.destroyBullet,null,this)}isEnemyInCameraView(t,e){return t.x+t.width>e.x&&t.x<e.x+e.width&&t.y+t.height>e.y&&t.y<e.y+e.height}destroyBullet(t,e){t.destroy();let i=this.physics.add.sprite(t.x,t.y,"explosion1");i.body.setAllowGravity(!1),i.anims.play("explosion1",!0),i.on("animationcomplete-explosion1",((t,e)=>{i.destroy()}))}playerFired(t,e){this.player.vulnerable&&"special"!==this.player.state&&(this.player.vulnerable=!1,this.player.takeDamage(e.damage),this.healthbarUpdate(),this.destroyBullet(e),this.player.sounds.hit.play()),this.time.delayedCall(1e3,(()=>{this.player.vulnerable=!0}))}handleBulletCollision(t,e){this.hitEnemy(e,20),this.player.sounds.hit.play(),"bullet"===t.texture.key&&t.destroy()}handleHitCollision(t,e){this.hitEnemy(e)}handleBodyCollision(t,e){let i=this.player.state;switch(this.player.state){case"kick":this.player.sounds.hit.play();case"jumpKick":this.player.sounds.hit.play();case"punch":this.player.sounds["player-punch"].play();break;case"throw":this.player.sounds.shield.play()}let s="right"===t.focusTo?t.x<=e.x:t.x>=e.x;if(["punch","kick","whip","specialExplosion","shield"].includes(i)&&s&&this.hitEnemy(e,{punch:20,kick:30,shield:50,whip:100,specialExplosion:150}[i]),"attacking"===e.state&&this.player.vulnerable){let t=e.damage||0;this.player.takeDamage(t),this.player.vulnerable=!1,this.healthbarUpdate(),this.time.delayedCall(800,(()=>{this.player.vulnerable=!0}))}}playMusic(){this.music=this.sound.add("bitest"),this.music.play(),this.music.setLoop(!0)}addBackground(){let t=this.game.config.width,e=this.game.config.height,i=this.inputHandler.width||t,s=this.inputHandler.height||e,a=t===i?0:(i-t)/2,n=e===s?0:(s-e)/2;this.bg1=this.add.tileSprite(a,n,t,e,"bg1").setScrollFactor(0).setOrigin(0,0),this.bg2=this.add.tileSprite(a,n,t,e,"bg2").setScrollFactor(0).setOrigin(0,0),this.bg3=this.add.tileSprite(a,n,t,e,"bg3").setScrollFactor(0).setOrigin(0,0),this.bg4=this.add.tileSprite(a,n,t,e,"bg4").setScrollFactor(0).setOrigin(0,0),this.bg5=this.add.tileSprite(a,n,t,e,"bg5").setScrollFactor(0).setOrigin(0,0),this.addUiContainer(a,n,t)}moveBackground(t){let e=this.cameras.main.scrollX/20;this.bg1.tilePositionX=.2*e,this.bg2.tilePositionX=.5*e,this.bg3.tilePositionX=1*e,this.bg4.tilePositionX=2*e,this.bg5.tilePositionX=3*e}createCamera(){this.physics.world.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels).startFollow(this.player,!0,1,.1,0,0).setFollowOffset(0,-50)}addTileMaps(){this.map=this.make.tilemap({key:"tilemapJson"});const t=this.map.addTilesetImage("greenTiles2","tilemapImage2"),e=this.map.addTilesetImage("newObjectSet","objectsTilemap");this.greenTilesLayer=this.map.createLayer("greenPlatforms",t),this.walls=this.map.createLayer("walls",t);const i=this.map.createLayer("background",e),s=this.map.createLayer("buildings",e),a=this.map.createLayer("farBackground",e),n=this.map.createLayer("foreground",e);a.setDepth(0),this.walls.setDepth(1).setCollisionByProperty({collider:!0}),this.physics.add.collider(this.player,this.walls),s.setDepth(2),this.greenTilesLayer.setDepth(3).setCollisionByProperty({collider:!0}),i.setDepth(4),n.setDepth(5),this.physics.add.collider(this.player,this.greenTilesLayer,null,(function(t,e){return t.body.velocity.y>0}));let r=this.physics.add.group();this.map.getObjectLayer("boxes").objects.forEach((t=>{let e,i;this.boxesEnabled[t.id]=!0,t.properties.forEach((t=>{switch(t.name){case"potion":e=t.value;break;case"flip":i=t.value}}));let s=new h(this,t.x,t.y,"chest",e,i);s.id=t.id,r.add(s),this.physics.add.overlap(this.player,s.potions,this.collectPotion,null,this)})),r.setDepth(5),this.physics.add.collider(this.greenTilesLayer,r),this.physics.add.collider(this.walls,r),this.physics.add.overlap(this.player,r,this.boxInteraction,null,this)}boxInteraction(t,e){this.inputHandler.isFightActionPressed()&&this.boxesEnabled[e.id]&&(this.boxesEnabled[e.id]=!1,e.openBox(),this.player.sounds.chest.play())}collectPotion(t,e){if(!e.collected){e.collected=!0,e.removeCollidesWith(this.player),this.time.delayedCall(200,(()=>{e.body.setVelocityY(-200)}));let t=!1;switch(e.name){case"health":if(this.player.health<100){let i=this.player.health+e.amount<=100?this.player.health+e.amount:100;this.player.health=i,this.healthbarUpdate(),t=!0,this.uiBlink(this.healthBar)}break;case"power":if(this.player.power<100){let i=this.player.power+e.amount<=100?this.player.power+e.amount:100;this.player.power=i,this.powerbarUpdate(),t=!0,this.uiBlink(this.powerBar)}break;case"ammo":this.player.ammoEnabled||(this.player.ammoEnabled=!0,this.enableAmmoMarker(),t=!0,this.uiBlink(this.ammoMarker))}t&&this.player.sounds.item.play(),this.time.delayedCall(500,(()=>{this.player.sounds.increase.setVolume(.3).play(),e.destroy()}))}}addUiContainer(t,e,i){this.uiContainer=this.add.container(t,e),this.uiContainer.setScrollFactor(0).setDepth(6),this.addHealthBar(),this.addPowerBar(i),this.addSpecialUI(i/2),this.addAmmoUI(i/2)}addHealthBar(){let t=this.player.health,e=this.add.graphics();e.fillStyle(0,1).fillRect(10,10,t,15),this.healthBar=this.add.graphics(),this.healthBar.fillStyle(51017,1).fillRect(10,10,t,15),this.uiContainer.add(e),this.uiContainer.add(this.healthBar);let i=this.add.image(12,11,"healthIcon").setOrigin(0);this.uiContainer.add(i)}addPowerBar(t){let e=this.player.power;this.powerbarBackground=this.add.graphics();let i=t-10-e;this.powerbarBackground.fillStyle(0,1).fillRect(i,10,e,15),this.powerBar=this.add.graphics(),this.powerBar.fillStyle(16509184,1).fillRect(i,10,e,15),this.powerBar.position=i,this.uiContainer.add(this.powerbarBackground),this.uiContainer.add(this.powerBar);let s=this.add.image(i+2,11,"powerIcon").setOrigin(0);this.uiContainer.add(s)}powerbarUpdate(){this.powerBar.clear(),this.player.power>0&&this.powerBar.fillStyle(16509184,1).fillRect(this.powerBar.position,10,this.player.power,15)}powerBarBlick(t=3){this.player.sounds.error.play(),this.tweens.add({targets:this.powerbarBackground,alpha:0,ease:"Linear",duration:200,yoyo:!0,repeat:t-1,onComplete:()=>{this.powerbarBackground.setAlpha(1)}})}uiBlink(t,e=3){this.tweens.add({targets:t,alpha:0,ease:"Linear",duration:200,yoyo:!0,repeat:e-1,onComplete:()=>{t.setAlpha(1)}})}healthbarUpdate(){this.healthBar.clear(),this.healthBar.fillStyle(51017,1).fillRect(10,10,this.player.health,15),this.player.health<=0&&(this.gameOver=!0)}addSpecialUI(t){let e=t-20,i=this.add.image(e,20,"specialMarker");i.setScale(.4),i.setOrigin(.5),this.specialMarkerFX=i.postFX.addColorMatrix(),this.uiContainer.add(i)}addAmmoUI(t){let e=t+20;this.ammoMarker=this.add.image(e,20,"ammo"),this.ammoMarker.setOrigin(.5),this.ammoMarkerFX=this.ammoMarker.postFX.addColorMatrix(),this.uiContainer.add(this.ammoMarker)}disableSpecialMarker(){this.specialMarkerFX.blackWhite()}enableAmmoMarker(){this.ammoMarkerFX.reset()}disableAmmoMarker(){this.ammoMarkerFX.blackWhite()}finishGame(){this.cameras.main.fadeOut(250,0,0,0),this.scene.start("Finish",{inputHandler:this.inputHandler})}}class u extends Phaser.Scene{constructor(){super({key:"UIScene",transparent:!0}),this.width,this.height,this.isPortrait,this.comboSequences=[],this.comboTimeout=null,this.comboList=[{sequence:["B","Y"],action:"combo2"},{sequence:["B","B"],action:"combo3"}]}init(t){this.inputHandler=t.inputHandler}create(){console.log("UI scene",this),this.width=this.scale.parentSize.width,this.height=this.scale.parentSize.height,this.isPortrait=this.width<this.height,this.scale.setGameSize(this.width,this.height),this.addVirtualJoystick(),this.addVirtualButtons()}addVirtualJoystick(){const t=this.isPortrait?.06*this.width:.1*this.width,e=this.isPortrait?(this.width-2*t)/4:100,i=this.isPortrait?e+t:e+t/4,s=this.height-e-t,a={x:i,y:s,radius:e,base:this.add.circle(i,s,e,8947848).setAlpha(.5),thumb:this.add.circle(i,s,e/2,13421772).setAlpha(.8),dir:"8dir",fixed:!0,enable:!0};this.inputHandler.setJoystickCursor(a)}addVirtualButtons(){const t=Math.min(30,.06*this.width),e={x:this.width-4*t,y:this.isPortrait?this.height-5*t:this.height/2+2*t};[{key:"A",x:e.x,y:e.y+2*t},{key:"B",x:e.x+2*t,y:e.y},{key:"X",x:e.x-2*t,y:e.y},{key:"Y",x:e.x,y:e.y-2*t}].forEach((e=>{const i=this.add.circle(e.x,e.y,t).setStrokeStyle(2,16711680).setFillStyle(0).setInteractive().on("pointerdown",(()=>this.onButtonDown(e.key,i))).on("pointerup",(()=>this.onButtonUp(e.key,i)));this.add.text(e.x,e.y,e.key,{fontFamily:"Arial Black",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5)}))}handleResize(t){t.width,t.height,this.scene.restart()}onButtonDown(t,e){e.setFillStyle(16711680),this.inputHandler.setButtonState(t,!0),this.recordKeyPress(t),this.time.delayedCall(this.inputHandler.holdingTime,(()=>{this.inputHandler.buttons[t]&&(this.inputHandler.holding[t]=!0)}))}onButtonUp(t,e){e.setFillStyle(0),this.inputHandler.setButtonState(t,!1),this.inputHandler.holding[t]=!1}recordKeyPress(t){this.comboTimeout&&clearTimeout(this.comboTimeout),this.comboSequences.push(t),this.checkCombo(),this.comboTimeout=setTimeout((()=>{this.comboSequences=[]}),this.inputHandler.maxComboTime)}checkCombo(){for(let t of this.comboList)if(this.isComboMatch(t.sequence)){this.inputHandler.runCombo(t.action),this.comboSequences=[];break}}isComboMatch(t){if(this.comboSequences.length<t.length)return!1;const e=this.comboSequences.slice(-t.length);return t.every(((t,i)=>t===e[i]))}}class m extends i.Scene{constructor(){super("GameOver")}init(t){this.inputHandler=t.inputHandler}preload(){this.load.image("flag","assets/jamaica-flag.png")}create(){var t,e,i,s;console.log("game over",this);let a={fontFamily:"Courier",fontSize:100,color:"#f6e800",stroke:"#000000",strokeThickness:8,align:"center"},n=this.game.config.width,h=this.game.config.height,r=(null==(t=this.inputHandler)?void 0:t.width)||n,o=(null==(e=this.inputHandler)?void 0:e.height)||h,l=(null==(i=this.inputHandler)?void 0:i.screenSize)||{width:n,height:h},d=n===r?0:(r-n)/2,c=h===o?0:(o-h)/2,p=r/n;if(null==(s=this.inputHandler)?void 0:s.isMobile)switch(this.inputHandler.orientation){case"portrait":d=0,c=(l.height-o)/2;break;case"landscape":d=(l.width-r)/2,c=0}this.add.image(d,c,"flag").setOrigin(0).setAlpha(.8).setScale(p);let u=this.add.text(l.width/2,l.height/2-30,"Game",a).setOrigin(.5),m=this.add.text(l.width/2,l.height/2+30,"Over",a).setOrigin(.5);this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:t=>{const e=t.getValue();u.setFontSize(20+64*e)}}),this.tweens.addCounter({from:0,to:1,duration:3e3,yoyo:!1,onUpdate:t=>{const e=t.getValue();m.setFontSize(20+64*e)},onComplete:()=>{u.destroy(),m.destroy(),this.addCredits(l),this.addRestartButton(l)}})}addRestartButton(t){let e=this.add.text(t.width/2,t.height/2+100,"RESTART",{fontFamily:"Courier",fontSize:20,color:"#000",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.scene.start("MainMenu",{inputHandler:this.inputHandler})}));this.tweens.add({targets:e,duration:500,y:t.height/2+105,yoyo:!0,repeat:-1})}addCredits(t){var e;let i={fontFamily:"Courier",fontSize:(null==(e=this.inputHandler)?void 0:e.isMobile)&&"portrait"===this.inputHandler.orientation?t.width/40:t.height/25,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"};this.add.text(t.width/2,t.height/2-30,"Credits \nOriginal History & Main Char Design & Animations: \nOral Ferguson \n\nPrograming, Music & Sound:\nAlan Reibel\n\nOther Graphics (Backgrounds, Tiles & Enemies): \ncraftpix.net\n\nTypewriter Sounds:\npixabay.com\n",i).setOrigin(.5).setWordWrapWidth(t.width-40)}}class y extends i.Scene{constructor(){super("Finish")}init(t){this.inputHandler=t.inputHandler}preload(){this.load.image("finish","assets/finish.png")}create(){var t,e,i,s;console.log("Finish",this);let a=this.game.config.width,n=this.game.config.height,h=(null==(t=this.inputHandler)?void 0:t.width)||a,r=(null==(e=this.inputHandler)||e.height,(null==(i=this.inputHandler)?void 0:i.screenSize)||{width:a,height:n}),o=h/a;if(console.log("scale",o),console.log("bgWidth",h),console.log("gamewidth",a),null==(s=this.inputHandler)?void 0:s.isMobile)switch(this.inputHandler.orientation){case"portrait":r.height;break;case"landscape":r.width}let l={fontFamily:"Courier",fontSize:20,color:"#f6e800",stroke:"#000000",strokeThickness:8,align:"center"};this.add.image(r.width/2,r.height/2,"finish").setAlpha(.8).setScale(o);let d=this.add.text(r.width/2,r.height/2-30,"Congrats!",{...l,fontSize:40}).setOrigin(.5),c=this.add.text(r.width/2,r.height/2+30,"You have successfully finished!",l).setOrigin(.5);this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:t=>{const e=t.getValue();d.setFontSize(30+10*e)}}),this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:t=>{const e=t.getValue();c.setFontSize(10+10*e)},onComplete:()=>{this.addRestartButton(r)}})}addRestartButton(t){let e=this.add.text(t.width/2,t.height/2+100,"RESTART",{fontFamily:"Courier",fontSize:25,color:"#f6e800",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.game.sound.stopAll(),this.scene.start("MainMenu",{inputHandler:this.inputHandler})}));this.tweens.add({targets:e,duration:500,y:t.height/2+105,yoyo:!0,repeat:-1})}addCredits(t){var e;let i={fontFamily:"Courier",fontSize:(null==(e=this.inputHandler)?void 0:e.isMobile)&&"portrait"===this.inputHandler.orientation?t.width/40:t.height/25,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"};this.add.text(t.width/2,t.height/2-30,"Credits \nOriginal History & Main Char Design & Animations: \nOral Ferguson \n\nPrograming, Music & Sound:\nAlan Reibel\n\nOther Graphics (Backgrounds, Tiles & Enemies): \ncraftpix.net\n\nTypewriter Sounds:\npixabay.com\n",i).setOrigin(.5).setWordWrapWidth(t.width/2)}}class g extends i.Scene{constructor(){super("Intro"),this.lines=[],this.maxLines=5,this.fullText={es:"\nEn un mundo devastado por interminables batallas, \ndonde la mitad de la población ha desaparecido sin \ndejar rastro, el caos se ha apoderado de Jamaica. \nLas bandas de capos opresores han tomado el control, \nsumiendo la isla en un estado de anarquía.\n\nNuestro protagonista, un individuo resistente y \ndeterminado, se encontró en medio de este tumulto. \n\nEn medio de los saqueos, un hombre armado le disparó, \ndejándolo al borde de la muerte. La desesperación \ny el miedo se apoderaron de él mientras yacía en \nel suelo, rodeado por el caos del momento.\n\nPero la esperanza no estaba completamente perdida. \nEn la misma ciudad, una anciana famosa por su \nconocimiento sobre hierbas místicas decidió intervenir. \nCon sus habilidades, creó un elixir único, una poción \nque combinaba plantas raras y mágicas. \n\nAl administrárselo, las heridas comenzaron a sanar. \nSin embargo, el elixir tuvo efectos secundarios: \nle otorgó una fuerza sobrehumana, velocidad y \ndurabilidad más allá de lo imaginable.\n\nRenacido con estos nuevos poderes, el protagonista \nse enfrenta ahora a un dilema. ¿Utilizará sus habilidades \npara restaurar el orden en Jamaica y liberar a su gente \ndel yugo de los capos opresores...\n\no se perderá en la sed de venganza y poder?",en:"\nIn a world devastated by endless battles, where half \nof the population has vanished without a trace, chaos \nhas taken over Jamaica. Oppressive gangs have seized \ncontrol, plunging the island into a state of anarchy.\n\nOur protagonist, a resilient and determined individual, \nfound himself in the midst of this turmoil. \n\nAmidst the looting, an armed man shot him, leaving him \non the brink of death. Desperation and fear consumed \nhim as he lay on the ground, surrounded by the chaos \nunfolding around him.\n\nBut hope was not entirely lost. In the same city, an elderly\nwoman known for her knowledge of mystical herbs \ndecided to intervene. With her skills, she created a unique \nelixir, a potion that combined rare and magical plants. \n\nUpon administering it, his wounds began to heal rapidly. \nHowever, the elixir had unexpected side effects: \nit granted him superhuman strength, speed, and durability \nbeyond imagination.\n\nReborn with these new powers, the protagonist now \nfaces a dilemma. Will he use his abilities to restore order\nin Jamaica and free his people from the oppressive ...\nor will he be consumed by the thirst for revenge and power?\n\nThe fate of Jamaica lies in his hands. \nThe battle for justice has only just begun."},this.currentLineIndex=0,this.typing=!1,this.speed=50,this.images={es:{5:"shoting",10:"lying",15:"elixir",20:"effects",25:"reborn"},en:{4:"shoting",9:"lying",14:"elixir",18:"effects",23:"reborn"}}}create(){const t=(navigator.language||navigator.userLanguage).substring(0,2);this.textArray=this.fullText[t].split("\n"),this.userLanguage=t;const e=this.game.config.width-40,i=this.game.config.height/2,s={fontSize:"14px",fontFamily:"Arial",fill:"#ffffff",wordWrap:{width:e,useAdvancedWrap:!0}};this.text=this.add.text(20,i+30,"",s),this.addInitialLines(),this.time.addEvent({delay:1600,callback:()=>{this.typing||(this.addNextLine(),this.lines.length>this.maxLines&&this.scrollText())},loop:!0}),this.keySounds=[this.sound.add("keySound1"),this.sound.add("keySound2"),this.sound.add("keySound3")],this.spaceSound=this.sound.add("spaceSound"),this.enterSound=this.sound.add("enterSound"),this.introMusic=this.sound.add("introMusic"),this.introMusic.play({volume:.9,loop:!1}),this.addSkipButton()}addSkipButton(){let t=this.game.config.width,e=this.game.config.height;this.skip=this.add.text(t-30,e-10,"SKIP",{fontFamily:"Courier",fontSize:15,color:"#ffffff",align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.endIntro()})),this.tweens.add({targets:this.skip,duration:300,y:e-15,yoyo:!0,repeat:-1})}endIntro(){this.cameras.main.fadeOut(250,0,0,0),this.game.sound.stopAll(),this.cameras.main.once("camerafadeoutcomplete",(function(t){this.scene.start("Preloader")}),this)}addInitialLines(){this.currentLineIndex<this.textArray.length&&(this.addLineWithTypewriterEffect(this.textArray[this.currentLineIndex]),this.currentLineIndex++,this.addImage("devasted-city"))}addNextLine(){if(this.currentLineIndex<this.textArray.length){if(Object.keys(this.images[this.userLanguage]).includes(`${this.currentLineIndex}`)){let t=this.images[this.userLanguage][this.currentLineIndex];this.addImage(t)}this.addLineWithTypewriterEffect(this.textArray[this.currentLineIndex]),this.currentLineIndex++}else this.endIntro()}addLineWithTypewriterEffect(t){this.typing=!0;let e=0;const i=t.length;let s="";const a=this.time.addEvent({callback:()=>{e<i?(s+=t[e],this.text.setText(this.lines.join("")+s),this.playTypingSound(t[e]),e++):(this.typing=!1,this.lines.push(`${s} \n`),this.text.setText(this.lines.join("")),this.enterSound.play(),a.remove())},delay:this.speed,callbackScope:this,loop:!0})}scrollText(){this.lines.shift(),this.text.setText(this.lines.join(""))}playTypingSound(t){" "===t?this.spaceSound.play():this.keySounds[Math.floor(Math.random()*this.keySounds.length)].play({volume:.2})}addImage(t){this.tweens.add({targets:this.introImage,alpha:0,ease:"Linear",duration:1e3,onComplete:()=>{this.introImage=this.add.image(0,0,t).setOrigin(0).setAlpha(0),this.tweens.add({targets:this.introImage,alpha:1,ease:"Linear",duration:1e3})}})}}const f=Phaser.Input.Keyboard.Key,b=Phaser.Input.Keyboard.KeyCodes;class w{constructor(t){this.cursorKeys={up:new f(t,b.UP),down:new f(t,b.DOWN),left:new f(t,b.LEFT),right:new f(t,b.RIGHT)},this.noKeyDown=!0}shutdown(t){for(var e in this.cursorKeys)this.cursorKeys[e].destroy();this.cursorKeys=void 0}destroy(t){shutdown(t)}createCursorKeys(){return this.cursorKeys}setKeyState(t,e){var i=this.cursorKeys[t];return i.enabled?(e&&(this.noKeyDown=!1),i.isDown!==e&&(v.timeStamp=Date.now(),v.keyCode=i.keyCode,e?i.onDown(v):i.onUp(v)),this):this}clearAllKeysState(){for(var t in this.noKeyDown=!0,this.cursorKeys)this.setKeyState(t,!1);return this}getKeyState(t){return this.cursorKeys[t]}get upKeyDown(){return this.cursorKeys.up.isDown}get downKeyDown(){return this.cursorKeys.down.isDown}get leftKeyDown(){return this.cursorKeys.left.isDown}get rightKeyDown(){return this.cursorKeys.right.isDown}get anyKeyDown(){return!this.noKeyDown}}var v={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0},k=180/Math.PI;const x={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var S={};const C=Phaser.Utils.Objects.GetValue,E=Phaser.Math.Distance.Between,H=Phaser.Math.Angle.Between;class D extends w{constructor(t,e){super(t),this.resetFromJSON(e)}resetFromJSON(t){null==this.start&&(this.start={x:0,y:0}),null==this.end&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(C(t,"enable",!0)),this.setMode(C(t,"dir","8dir")),this.setDistanceThreshold(C(t,"forceMin",16));var e=C(t,"start.x",null),i=C(t,"start.y",null),s=C(t,"end.x",null),a=C(t,"end.y",null);return this.setVector(e,i,s,a),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(t){return"string"==typeof t&&(t=x[t]),this.dirMode=t,this}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||this.clearVector(),this._enable=t,this}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(t){return t<0&&(t=0),this.forceMin=t,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(t,e,i,s){if(!this.enable)return this;if(null===t)return this.clearVector(),this;if(void 0===i&&(i=t,t=0,s=e,e=0),this.start.x=t,this.start.y=e,this.end.x=i,this.end.y=s,this.forceMin>0&&this.force<this.forceMin)return this.clearVector(),this;this.noKeyDown=!0;var a=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=S),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i}(this.angle,this.dirMode,!0);for(var n in a)this.setKeyState(n,a[n]);return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return E(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return H(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return this.rotation*k}get octant(){var t=0;return this.rightKeyDown?t=this.downKeyDown?45:0:this.downKeyDown?t=this.leftKeyDown?135:90:this.leftKeyDown?t=this.upKeyDown?225:180:this.upKeyDown&&(t=this.rightKeyDown?315:270),t}}const K={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=!0===t||void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var P={};const T=Phaser.Utils.Objects.GetValue,B=Phaser.Geom.Circle,F=Phaser.Geom.Circle.Contains;class M extends D{constructor(t,e){var i=t.scene;super(i,e);var s=T(e,"eventEmitter",void 0),a=T(e,"EventEmitterClass",void 0);this.setEventEmitter(s,a),this.scene=i,this.mainCamera=i.sys.cameras.main,this.pointer=void 0,this.gameObject=t,this.radius=T(e,"radius",100),t.setInteractive(new B(t.displayOriginX,t.displayOriginY,this.radius),F),this.boot()}resetFromJSON(t){return super.resetFromJSON(t),this.pointer=void 0,this}toJSON(){var t=super.toJSON();return t.radius=this.radius,t}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(t){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(t){if(this._enable!==t)return t||(this.pointer=void 0),super.enable=t,this}destroy(t){this.shutdown(t)}onParentDestroy(t,e){this.destroy(e)}onKeyDownStart(t){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.onKeyDown(t),this.emit("pointerdown",t))}onKeyDown(t){if(this.pointer===t){var e=function(t,e,i){var s=t.camera;return s?(void 0===i?i={}:!0===i&&(i=P),s===e?(i.x=t.worldX,i.y=t.worldY):s.getWorldPoint(t.x,t.y,i),i):null}(t,this.mainCamera,!0);if(e){var i=t.camera,s=this.gameObject,a=s.x,n=s.y;0===s.scrollFactorX&&(a+=i.scrollX),0===s.scrollFactorY&&(n+=i.scrollY),this.setVector(a,n,e.x,e.y),this.end.x=e.x,this.end.y=e.y,this.emit("update")}}}onKeyUp(t){this.pointer===t&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",t))}forceUpdate(){var t=this.pointer;return t&&t.isDown?(this.onKeyDown(t),this):this}}Object.assign(M.prototype,K);const I=Phaser.Utils.Objects.GetValue;class A{constructor(t,e){void 0===e&&(e={});var i=I(e,"eventEmitter",void 0),s=I(e,"EventEmitterClass",void 0);this.setEventEmitter(i,s),e.eventEmitter=this.getEventEmitter(),this.scene=t,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(I(e,"radius",100)),this.addBase(I(e,"base",void 0),e),this.addThumb(I(e,"thumb",void 0));var a=I(e,"x",0),n=I(e,"y",0);this.base.setPosition(a,n),this.thumb.setPosition(a,n),I(e,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(t,e){return this.x===t&&this.y===e||(this.x=t,this.y=e,this.forceUpdateThumb()),this}set x(t){this.x!==t&&(this.base.x=t,this.thumb.x=t)}set y(t){this.y!==t&&(this.base.y=t,this.thumb.y=t)}get x(){return this.base.x}get y(){return this.base.y}setVisible(t){return this.visible=t,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(t){this.base.visible=t,this.thumb.visible=t,this.enable=t}get enable(){return this.touchCursor.enable}set enable(t){this.touchCursor.setEnable(t)}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(t){return this.radius=t,this}addBase(t,e){return this.base&&this.base.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),void 0===e&&(e={}),e.eventEmitter=this.getEventEmitter(),this.touchCursor=new M(t,e),this.base=t,this}addThumb(t){return this.thumb&&this.thumb.destroy(),void 0===t&&(t=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=t,this}setScrollFactor(t){return this.base.setScrollFactor(t),this.thumb.setScrollFactor(t),this}boot(){this.on("update",this.update,this)}update(){var t,e,i=this.touchCursor,s=i.dirMode;if(i.anyKeyDown)if(i.force>this.radius){var a=i.rotation;t=0!==s?Math.cos(a)*this.radius:0,e=1!==s?Math.sin(a)*this.radius:0}else t=0!==s?i.forceX:0,e=1!==s?i.forceY:0;else t=0,e=0;return this.thumb.x=this.base.x+t,this.thumb.y=this.base.y+e,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(A.prototype,K);class O extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t,e){return new A(t,e)}addVectorToCursorKeys(t){return new D(void 0,t)}}const W={type:Phaser.AUTO,width:400,height:300,parent:"game-container",fullscreenTarget:"game-container",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,physics:{default:"arcade",arcade:{gravity:{y:500}}},scene:[s,l,d,p,u,m,y,g],plugins:{global:[{key:"rexVirtualJoystick",plugin:O,start:!0}]},input:{activePointers:3}};new Phaser.Game(W);
