var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);import{p as i}from"./phaser-C2_wa_Fb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("splash","assets/captain-splash.png"),this.loadIntroAudios(),this.loadIntroImages()}create(){this.input.once("pointerdown",(()=>{this.scene.start("Intro")})),this.addStartButton()}loadIntroAudios(){this.load.audio("keySound1","assets/sounds/typewrite/key1.mp3"),this.load.audio("keySound2","assets/sounds/typewrite/key2.mp3"),this.load.audio("keySound3","assets/sounds/typewrite/key3.mp3"),this.load.audio("spaceSound","assets/sounds/typewrite/spaceBar.mp3"),this.load.audio("enterSound","assets/sounds/typewrite/newLine.mp3"),this.load.audio("introMusic","assets/sounds/intro.mp3")}loadIntroImages(){this.load.image("devasted-city","assets/intro/devasted-city.png"),this.load.image("shoting","assets/intro/shoting.png"),this.load.image("lying","assets/intro/lying.png"),this.load.image("elixir","assets/intro/elixir.png"),this.load.image("effects","assets/intro/effects.png"),this.load.image("reborn","assets/intro/reborn.png")}addStartButton(){let e=this.game.config.width,t=this.game.config.height,i=this.add.text(e/2,t/2,"START",{fontFamily:"Courier",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.scene.start("Intro")}));this.tweens.add({targets:i,duration:500,y:t/2+1,yoyo:!0,repeat:-1})}}const a={flyingRobot:{animations:{Idle:{frameWidth:32,frameHeight:32,frames:4,frameRate:10,repeat:-1},Death:{frameWidth:32,frameHeight:32,frames:4,frameRate:8,repeat:0},Attack:{frameWidth:32,frameHeight:38,frames:4,frameRate:10,repeat:0},Hurt:{frameWidth:32,frameHeight:32,frames:2,frameRate:8,repeat:0},Walk:{frameWidth:32,frameHeight:32,frames:4,frameRate:10,repeat:-1}},damage:5,fly:!0,speed:50,health:100,behavior:(e,t)=>{let{player:i}=e,{worldView:s}=e.cameras.main,a=s.x+30,h=s.x+s.width-30,n=s.y+30,r=s.y+s.height-30,o=Phaser.Math.Distance.BetweenPoints(i,t)<=50,l=i.y-i.height/2;switch(t.movingDirectionX){case"left":(t.x<=a||t.body.blocked.left)&&(t.focusTo="right",t.movingDirectionX="right");break;case"right":(t.x>=h||t.body.blocked.right)&&(t.focusTo="left",t.movingDirectionX="left")}switch(t.movingDirectionY){case"up":if(t.y<=n||t.body.blocked.up){let e=i.x<t.x?"left":"right";t.movingDirectionY="none",t.movingDirectionX=e,t.attackDone=!1}break;case"down":o&&(t.stop(),t.attack()),(t.y>=r||t.y>=l||t.body.blocked.down)&&(t.movingDirectionY="up",t.movingDirectionX=t.focusTo),t.attackDone&&(t.movingDirectionY="up");break;case"none":t.attackDone||i.x-t.x<20&&i.x-t.x>-20&&(t.movingDirectionY="down",t.movingDirectionX="none")}t.move(t.movingDirectionX,t.movingDirectionY)}},weelRobot:{animations:{Idle:{frameWidth:32,frameHeight:24,frames:4,frameRate:10,repeat:-1},Death:{frameWidth:32,frameHeight:24,frames:4,frameRate:8,repeat:0},Attack:{frameWidth:32,frameHeight:24,frames:4,frameRate:10,repeat:0},Hurt:{frameWidth:32,frameHeight:24,frames:2,frameRate:8,repeat:0},Walk:{frameWidth:32,frameHeight:24,frames:4,frameRate:10,repeat:-1}},damage:5,speed:50,health:100,behavior:(e,t)=>{let i=e.player,s=Phaser.Math.Distance.BetweenPoints(i,t),a=s<=200,h=i.x<t.x?"left":"right",n=i.focusTo===h?s<=20:s<=25,r=i.focusTo===h?s<=15:s<=20,o=i.x-t.x<=10&&i.x-t.x>=-10&&(i.y-t.y>=30||i.y-t.y<=-30);a&&!o?r?(h="left"===h?"right":"left",t.move(h)):n?(t.stop(),t.attack()):t.move(h):t.stop()}},basebolHitter:{animations:{Idle:{frameWidth:38,frameHeight:34,frames:4,frameRate:10,repeat:-1},Death:{frameWidth:38,frameHeight:34,frames:6,frameRate:8,repeat:0},Attack:{frameWidth:38,frameHeight:34,frames:6,frameRate:12,repeat:0},Hurt:{frameWidth:38,frameHeight:34,frames:2,frameRate:8,repeat:0},Walk:{frameWidth:38,frameHeight:34,frames:6,frameRate:10,repeat:-1}},damage:10,fly:!1,speed:50,health:100,behavior:(e,t)=>{let i=e.player,s=Phaser.Math.Distance.BetweenPoints(i,t),a=s<=200,h=i.x-t.x<=10&&i.x-t.x>=-10&&(i.y-t.y>=30||i.y-t.y<=-30);if(a&&!h){let e=i.x<t.x?"left":"right";s<=20?(t.stop(),t.attack()):t.move(e)}else t.stop()}},mutantDog:{animations:{Idle:{frameWidth:38,frameHeight:40,frames:4,frameRate:10,repeat:-1},Death:{frameWidth:48,frameHeight:40,frames:6,frameRate:8,repeat:0},Attack:{frameWidth:38,frameHeight:40,frames:5,frameRate:9,repeat:0},Hurt:{frameWidth:38,frameHeight:40,frames:2,frameRate:8,repeat:0},Walk:{frameWidth:38,frameHeight:40,frames:6,frameRate:10,repeat:-1}},shot:!0,fly:!1,speed:50,health:100,bulletImage:"ball2",bulletDamage:15,behavior:(e,t)=>{let i=e.player,s=Phaser.Math.Distance.BetweenPoints(i,t),a=s<=150,h=Phaser.Math.CeilTo(i.x)<Phaser.Math.CeilTo(t.x);if(t.focusTo=h?"left":"right",a)if(s<=30){let e=h?"right":"left";t.move(e)}else t.stop(),t.attack();else t.stop()}},brainTank:{animations:{Idle:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1},Death:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Attack:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:0},Hurt:{frameWidth:30,frameHeight:34,frames:2,frameRate:12,repeat:0},Walk:{frameWidth:30,frameHeight:34,frames:4,frameRate:12,repeat:-1}},shot:!0,fly:!1,speed:30,health:150,bulletImage:"ball1",bulletDamage:25,behavior:(e,t)=>{let i=e.player,s=Phaser.Math.Distance.BetweenPoints(i,t),a=s<=200,h=Phaser.Math.CeilTo(i.x)<Phaser.Math.CeilTo(t.x);if(t.focusTo=h?"left":"right",a)if(s<=30){let e=h?"right":"left";t.move(e)}else t.stop(),t.attack();else t.stop()}}};class h extends Phaser.Physics.Arcade.Sprite{constructor(e,i,s,h){super(e,i,s,`${h}-Idle`),t(this,"startPosition"),t(this,"state","idle"),t(this,"focusTo","right"),t(this,"bullets"),t(this,"bulletImage"),t(this,"bulletDamage"),t(this,"bulletFired",!1),t(this,"movingDirectionX"),t(this,"movingDirectionY","none"),t(this,"invulnerable",!1),t(this,"shouldAttack",!0),t(this,"attackDone",!1),t(this,"attackCounter",0),t(this,"nextAttackWait",2e3),t(this,"sounds",[]),this.name=h,e.add.existing(this),e.physics.add.existing(this),this.addSounds(),this.setBounce(.2),this.body.collideWorldBounds=!0,this.startPosition={x:this.x,y:this.y},this.anims.play(`${h}-Idle`),this.scene=e,this.health=a[h].health||100,this.speed=a[h].speed||100,this.behavior=a[h].behavior,this.bulletImage=a[h].bulletImage,this.bulletDamage=a[h].bulletDamage,this.damage=a[h].damage,this.shot=a[h].shot,this.fly=a[h].fly||!1,this.bullets=this.scene.physics.add.group(),this.setDepth(5),this.bullets.setDepth(5)}update(){"hurt"!==this.state&&"dying"!==this.state&&this.behavior(this.scene,this)}attack(){if("attacking"!==this.state)if(this.attackCounter<2){if(this.shouldAttack){this.attackDone=!1,this.shouldAttack=!1,this.state="attacking";let e="left"===this.focusTo;this.anims.play(`${this.name}-Attack`,!0).setFlipX(e),"weelRobot"===this.name&&this.attackMovement(),this.shot?this.scene.time.delayedCall(100,(()=>{this.fire(this.scene)})):this.sounds["enemy-punch"].play(),this.scene.time.delayedCall(200,(()=>{this.state="idle",this.attackCounter++,this.attackDone=!0,this.shouldAttack=!0,this.shot&&(this.bulletFired=!1)}))}}else this.state="attacking",this.scene.time.delayedCall(this.nextAttackWait,(()=>{this.state="idle",this.attackCounter=0}))}attackMovement(){this.scene.tweens.add({targets:this,y:this.y-20,ease:"Power1",duration:200})}fire(e){if(!this.bulletFired){let t="right"===this.focusTo?1:-1;this.bulletFired=!0;let i=e.physics.add.image(this.x,this.y,this.bulletImage);i.damage=this.bulletDamage,i.setDepth(5),this.bullets.add(i),i.setVelocityX(500*t),i.body.setAllowGravity(!1),this.sounds["enemy-shot"].play()}}hurt(e){"hurt"===this.state||this.invulnerable||(this.state="hurt",this.invulnerable=!0,this.anims.play(`${this.name}-Hurt`,!0),this.takeDamage(e),this.once("animationcomplete",(()=>{this.invulnerable=!1,this.state="idle"})))}move(e=this.focusTo,t="none"){if("attacking"!==this.state){switch(this.movingDirectionX=e,this.turn=e!==this.focusTo,this.focusTo=e,this.state="walk",e){case"left":this.setVelocityX(-this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!0);break;case"right":this.setVelocityX(this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!1);break;case"none":this.setVelocityX(0)}if(this.fly)switch(this.movingDirectionY=t,t){case"up":this.setVelocityY(-80),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!1);break;case"down":this.setVelocityY(120);break;case"none":this.setVelocityY(0)}}}stop(){if("attacking"!==this.state&&"hurt"!==this.state&&"dying"!==this.state){this.setVelocityX(0),this.state="idle";let e="left"===this.focusTo;this.anims.play(`${this.name}-Idle`,!0).setFlipX(e)}}takeDamage(e){this.health-=e,this.health<=0&&this.die()}die(){"dying"!==this.state&&(this.state="dying",this.anims.play(`${this.name}-Death`,!0),this.once("animationcomplete",(()=>{this.sounds["enemy-die"].play(),this.destroy()})))}static loadResources(e){for(const[t,i]of Object.entries(a))for(const[s,a]of Object.entries(i.animations))e.load.spritesheet(`${t}-${s}`,`sprites/enemies/${t}/${s}.png`,{frameWidth:a.frameWidth,frameHeight:a.frameHeight});e.load.image("ball1","sprites/enemies/bullets/Ball1.png"),e.load.image("ball2","sprites/enemies/bullets/Ball2.png")}static createAnimations(e){for(const[t,i]of Object.entries(a))for(const[s,a]of Object.entries(i.animations))e.anims.create({key:`${t}-${s}`,frames:e.anims.generateFrameNumbers(`${t}-${s}`,{start:0,end:a.frames-1}),frameRate:a.frameRate,repeat:a.repeat})}addSounds(){["enemy-die","enemy-shot","enemy-punch"].forEach((e=>{this.sounds[e]=this.scene.sound.add(e)}))}}const n={bird:{speed:150,fly:!0,animations:{Idle:{frameWidth:24,frameHeight:16,frames:4,frameRate:10,repeat:-1},Walk:{frameWidth:24,frameHeight:16,frames:6,frameRate:18,repeat:-1}},width:16,height:16,offSet:{x:0,y:2},behavior:(e,t)=>{let{player:i}=e;e.cameras.main;let s=Phaser.Math.Distance.BetweenPoints(i,t)<=100;switch(t.movingDirectionX){case"left":t.body.blocked.left&&(t.focusTo="right");break;case"right":t.body.blocked.right&&(t.focusTo="left");break;case"none":t.movingDirectionX=t.focusTo}s&&t.move(t.focusTo,"up")}},bat:{speed:150,fly:!0,animations:{Idle:{frameWidth:32,frameHeight:32,frames:4,frameRate:8,repeat:-1},Walk:{frameWidth:32,frameHeight:32,frames:5,frameRate:18,repeat:-1}},behavior:(e,t)=>{let{worldView:i}=e.cameras.main,s=(i.x,i.x,i.width,i.y,i.y+i.height-50),{player:a}=e,h=Phaser.Math.Distance.BetweenPoints(a,t)<=100;if("flying"===t.state){switch(t.movingDirectionX){case"left":t.body.blocked.left&&(t.focusTo="right",t.movingDirectionX="right");break;case"right":t.body.blocked.right&&(t.focusTo="left",t.movingDirectionX="left");break;case"none":t.movingDirectionX=t.focusTo}switch(t.movingDirectionY){case"up":t.body.blocked.up&&(t.movingDirectionY="down");break;case"down":(t.y>=s||t.body.blocked.down)&&(t.movingDirectionY="up")}t.move(t.movingDirectionX,t.movingDirectionY)}h&&"idle"===t.state&&(t.move(t.focusTo,"down"),t.state="flying")}},mouse:{speed:120,animations:{Idle:{frameWidth:20,frameHeight:10,frames:4,frameRate:12,repeat:-1},Walk:{frameWidth:20,frameHeight:10,frames:6,frameRate:18,repeat:-1}},behavior:(e,t)=>{let{player:i}=e;e.cameras.main;let s=Phaser.Math.Distance.BetweenPoints(i,t)<=50;switch(t.movingDirectionX){case"left":t.body.blocked.left&&(t.focusTo="right");break;case"right":t.body.blocked.right&&(t.focusTo="left");break;case"none":t.movingDirectionX=t.focusTo}s?t.move(t.focusTo):t.stop()}},rat:{speed:130,animations:{Idle:{frameWidth:26,frameHeight:12,frames:4,frameRate:14,repeat:-1},Walk:{frameWidth:26,frameHeight:12,frames:4,frameRate:24,repeat:-1}},behavior:(e,t)=>{let{player:i}=e;e.cameras.main;let s=Phaser.Math.Distance.BetweenPoints(i,t)<=50;switch(t.movingDirectionX){case"left":t.body.blocked.left&&(t.focusTo="right");break;case"right":t.body.blocked.right&&(t.focusTo="left");break;case"none":t.movingDirectionX=t.focusTo}s?t.move(t.focusTo):t.stop()}},scorpio:{speed:50,animations:{Idle:{frameWidth:48,frameHeight:48,frames:4,frameRate:10,repeat:-1},Walk:{frameWidth:48,frameHeight:48,frames:4,frameRate:10,repeat:-1}},behavior:(e,t)=>{let{player:i}=e;e.cameras.main;let s=Phaser.Math.Distance.BetweenPoints(i,t)<=40;switch(t.movingDirectionX){case"left":t.body.blocked.left&&(t.focusTo="right");break;case"right":t.body.blocked.right&&(t.focusTo="left");break;case"none":t.movingDirectionX=t.focusTo}s?t.move(t.focusTo):t.stop()}}};class r extends Phaser.Physics.Arcade.Sprite{constructor(e,i,s,a,h){super(e,i,s,`${a}-Idle`),t(this,"movingDirectionX"),t(this,"movingDirectionY"),t(this,"state","idle"),this.name=a,this.scene=e;const r=n[a];this.speed=r.speed,this.behavior=r.behavior,this.fly=r.fly,this.width=r.width,this.height=r.height,e.add.existing(this),e.physics.add.existing(this),this.setBounce(.2),this.body.collideWorldBounds=!0,this.focusTo=h?"left":"right",r.offSet&&this.setOffset(r.offSet.x,r.offSet.y),this.setFlipX(h),this.setDepth(4),this.setOrigin(.5),this.setScale(.8),this.anims.play(`${a}-Idle`)}update(){this.behavior(this.scene,this)}move(e=this.focusTo,t="none"){switch(this.movingDirectionX=e,e){case"left":this.setVelocityX(-this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!0);break;case"right":this.setVelocityX(this.speed),this.anims.play(`${this.name}-Walk`,!0).setFlipX(!1);break;case"none":this.setVelocityX(0)}if(this.fly)switch(this.movingDirectionY=t,t){case"up":this.setVelocityY(-this.speed);break;case"down":this.setVelocityY(this.speed);break;case"none":this.setVelocityY(0)}}stop(){this.setVelocityX(0),this.anims.play(`${this.name}-Idle`,!0)}static loadResources(e){for(const[t,i]of Object.entries(n))for(const[s,a]of Object.entries(i.animations))e.load.spritesheet(`${t}-${s}`,`sprites/animals/${t}/${s}.png`,{frameWidth:a.frameWidth,frameHeight:a.frameHeight})}static createAnimations(e){for(const[t,i]of Object.entries(n))for(const[s,a]of Object.entries(i.animations))e.anims.create({key:`${t}-${s}`,frames:e.anims.generateFrameNumbers(`${t}-${s}`,{start:0,end:a.frames-1}),frameRate:a.frameRate,repeat:a.repeat})}}class o extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s,a,h){super(e,t,i,s),this.scene=e,this.setFlipX(h),this.scene.physics.world.enable(this),this.scene.add.existing(this),this.setCollideWorldBounds(!0),this.potions=this.scene.physics.add.group(),this.PotionName=a,this.collected=!1,this.potionAmounts={health:25,power:50,ammo:10}}static createAnimations(e){e.anims.create({key:"chestOpen",frames:e.anims.generateFrameNumbers("chest",{start:0,end:3}),frameRate:8,repeat:0})}openBox(){this.anims.play("chestOpen"),this.on("animationcomplete-chestOpen",((e,t)=>{this.showPotion()}))}showPotion(){let e=this.scene.physics.add.sprite(this.x,this.y-15,this.PotionName);e.amount=this.potionAmounts[this.PotionName],e.name=this.PotionName,this.potions.add(e),e.body.setAllowGravity(!1),e.setDepth(3)}}class l extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t,i,"bullet"),this.scene=e,this.scene.physics.world.enable(this),this.scene.add.existing(this),this.setCollideWorldBounds(!0)}fire(e,t,i){let s="right"===i?1:-1,a="left"===i;this.bulletFlash(e,t),this.body.reset(e,t),this.body.setAllowGravity(!1),this.setActive(!0),this.setVisible(!0),this.setScale(.5),this.setVelocityX(1e3*s),this.setFlipX(a),this.setDepth(5)}update(){this.y<0&&(this.setActive(!1),this.setVisible(!1))}animationComplete(e,t){this.destroy()}bulletFlash(e,t){let i=this.scene.add.graphics();i.fillStyle(16777215,1),i.fillCircle(e,t,10),i.postFX.addBloom(16777215,1,1,1,2),this.scene.tweens.add({targets:i,x:e,y:t,scale:0,opacity:0,duration:100,onComplete:()=>{i.destroy()}})}}class d extends Phaser.Physics.Arcade.Sprite{constructor(e,i,s,a){super(e,i,s,a),t(this,"state","idle"),t(this,"isMoving",!1),t(this,"isJumping",!1),t(this,"blockedJump",!1),t(this,"velocity",100),t(this,"specialEnabled",!0),t(this,"ammoEnabled",!0),t(this,"shield"),t(this,"shieldThrown",!1),t(this,"shieldCached",!0),t(this,"health",100),t(this,"power",100),t(this,"vulnerable",!0),t(this,"movingDirection","right"),t(this,"focusTo","right"),t(this,"blockedMovement",!1),t(this,"bulletFired",!1),t(this,"bullets"),t(this,"fightEnds",!0),t(this,"blockedFight",!1),t(this,"originalWidth",26),t(this,"originalHeight",52),t(this,"sounds",[]),this.scene=e,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setDepth(5).setBounce(.2).setCollideWorldBounds(!0).setScale(.6).setSize(this.originalWidth,this.originalHeight).setOffset(24,6).setMaxVelocity(100,400),this.addSounds(),this.setFightAnimationState(),this.anims.play("idle",!0),this.originalX=this.x,this.originalY=this.y,this.bullets=this.scene.physics.add.group({classType:l,runChildUpdate:!0,allowGravity:!1})}static createAnimations(e){e.anims.create({key:"idle",frames:e.anims.generateFrameNumbers("captain-idle",{start:0,end:6}),frameRate:12,repeat:-1}),e.anims.create({key:"run",frames:e.anims.generateFrameNumbers("captain-run",{start:0,end:9}),frameRate:12,repeat:-1}),e.anims.create({key:"punch",frames:e.anims.generateFrameNumbers("captain-fight",{start:1,end:3}),frameRate:12,repeat:0}),e.anims.create({key:"kick",frames:e.anims.generateFrameNumbers("captain-fight",{start:4,end:7}),frameRate:12,repeat:0}),e.anims.create({key:"shield",frames:e.anims.generateFrameNumbers("captain-fight",{start:8,end:11}),frameRate:12,repeat:0}),e.anims.create({key:"throw",frames:e.anims.generateFrameNumbers("shield-throw",{start:0,end:5}),frameRate:12,repeat:0}),e.anims.create({key:"catch",frames:e.anims.generateFrameNumbers("shield-throw",{start:12,end:15}),frameRate:12,repeat:0}),e.anims.create({key:"fly",frames:e.anims.generateFrameNumbers("shield-fly",{start:0,end:7}),frameRate:12,repeat:0}),e.anims.create({key:"whip",frames:e.anims.generateFrameNumbers("whip",{start:0,end:19}),frameRate:15,repeat:0}),e.anims.create({key:"special",frames:e.anims.generateFrameNumbers("special",{start:0,end:45}),frameRate:18,repeat:0}),e.anims.create({key:"block",frames:e.anims.generateFrameNumbers("special",{start:0,end:10}),frameRate:12,repeat:0}),e.anims.createFromAseprite("shot")}setFightAnimationState(){let e=["punch","punch2","kick","shield","fly","catch","burst","jumpKick","whip","special"];this.on("animationcomplete",((t,i)=>{e.includes(t.key)&&(this.fightEnds=!0,this.vulnerable=!0,this.blockedMovement=!1,this.state="idle",this.idle())}))}resetSprite(){let e="right"===this.focusTo?24:15;this.setVelocityX(0),this.setSize(this.originalWidth,this.originalHeight),this.setPosition(this.originalX,this.y),this.setOffset(e,7),this.setScale(.6),this.scene.cameras.main.startFollow(this,!0,1,.1,0,0)}idle(){this.setVelocityX(0),"throw"!==this.state&&"jump"!==this.state&&"jumpKick"!==this.state&&"kick"!==this.state&&"shield"!==this.state&&"catch"!==this.state&&"whip"!==this.state&&"special"!==this.state&&"landing"!==this.state&&"punch"!==this.state&&"burst"!==this.state&&(this.anims.play("idle",!0),this.state="idle")}move(e){if(!this.blockedMovement){this.originalX=this.x,this.originalY=this.y,this.movingDirection=e,this.focusTo=e;let t="left"===e?-1:1,i="left"===e,s="right"===this.focusTo?24:15;this.setVelocityX(this.velocity*t),this.setOffset(s,6),"jump"!==this.state&&"runningJump"!==this.state&&"landing"!==this.state&&(this.anims.play("run",!0).setFlipX(i),this.state="running")}}takeDamage(e){this.startBlink(3),this.sounds.hurt.setVolume(.5).play(),this.health-=e}throwShield(){if("throw"!==this.state){this.shield=this.scene.physics.add.sprite(this.x,this.y,"shield-fly"),this.shield.setScale(.6),this.shield.setDepth(5),this.bullets.add(this.shield);let e=150;this.blockedMovement=!0,this.anims.play("throw",!0),this.state="throw",this.scene.time.delayedCall(400,(()=>{this.sounds.boomerang.play()})),this.scene.time.delayedCall(375,(()=>{let t={x:"right"==this.focusTo?this.x+this.width/2:this.x-this.width/2,y:this.y};this.shield.setPosition(t.x,t.y),this.shield.anims.play("fly",!0);let i="right"==this.focusTo?t.x+e:t.x-e;this.scene.tweens.add({targets:this.shield,x:i,y:t.y,duration:333,ease:"Power1",onComplete:()=>{this.flyBackTween()}})}))}}flyBackTween(){this.scene.tweens.add({targets:this.shield,x:this.x,y:this.y,duration:333,ease:"Power1",onComplete:()=>{this.shield.setVisible(!1),this.shieldThrown=!1,this.shieldCached=!0,this.shield.destroy(),this.anims.play("catch",!0)}}),this.on("animationcomplete-catch",((e,t)=>{this.state="idle",this.idle(),this.fightEnds=!0,this.blockedMovement=!1}))}fireBullet(e){let t="right"==this.focusTo?.5*this.width:-.5*this.width,i=e.player.x+t,s=this.bullets.get(i,e.player.y);s?(s.fire(i,e.player.y,this.focusTo),this.sounds["player-fire"].play()):console.log("No hay balas disponibles")}burst(){this.ammoEnabled?(this.resetSprite(),this.state="burst",this.blockedFight=!0,this.fightEnds=!1,this.setVelocityX(0),this.blockedMovement=!0,this.anims.play("burst",!0),this.on("animationcomplete-burst",((e,t)=>{this.resetSprite(),this.state="idle",this.idle(),this.fightEnds=!0,this.blockedMovement=!1,this.ammoEnabled=!1,this.scene.disableAmmoMarker()}))):(this.sounds.error.play(),this.scene.uiBlink(this.scene.ammoMarker,2,!0))}kick(){"whip"!==this.state&&(this.blockedFight=!0,this.fightEnds=!1,this.anims.play("kick",!0),this.state="kick",this.sounds["pre-punch"].play(),this.on("animationcomplete-kick",((e,t)=>{this.state="idle",this.idle(),this.fightEnds=!0})))}punch(){"whip"!==this.state&&(this.resetSprite(),this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch"),this.state="punch",this.sounds["pre-punch"].play(),this.on("animationcomplete-punch",((e,t)=>{this.state="idle",this.idle(),this.fightEnds=!0})))}punch2(){"whip"!==this.state&&(this.resetSprite(),this.blockedFight=!0,this.fightEnds=!1,this.anims.play("punch2",!0),this.state="punch2",this.sounds["pre-punch"].play(),this.on("animationcomplete-punch2",((e,t)=>{this.state="idle",this.idle(),this.fightEnds=!0})))}whip(){if(!this.isJumping){let e="right"===this.focusTo?24:90,t="right"===this.focusTo?1:-1;this.blockedFight=!0,this.fightEnds=!1,this.vulnerable=!1,this.blockedMovement=!0,this.scene.cameras.main.stopFollow(),this.setVelocityX(0),this.anims.play("whip",!0),this.setPosition(this.originalX+22*t,this.y-1),this.setOffset(e,10),this.setScale(.58),this.scene.time.delayedCall(600,(()=>{"whip"===this.anims.currentAnim.key&&this.anims.isPlaying&&(this.sounds.whip.play(),this.state="whip")})),this.scene.time.delayedCall(740,(()=>{"whip"===this.state&&(this.setSize(135,64),this.power-=25,this.scene.powerbarUpdate())})),this.on("animationcomplete-whip",((e,t)=>{this.resetSprite(),this.blockedMovement=!1}))}}shieldAttack(){this.setVelocityX(0),this.blockedFight=!0,this.fightEnds=!1,this.shieldCached&&!this.shieldThrown&&(this.shieldThrown=!0,this.throwShield())}shieldHit(){this.resetSprite(),"up"!==this.movingDirection&&"down"!==this.movingDirection&&"throw"!==this.state&&(this.blockedFight=!0,this.fightEnds=!1,this.anims.play("shield",!0),this.state="shield",this.scene.time.delayedCall(100,(()=>{"shield"===this.state&&this.sounds["pre-punch"].play()})))}handleJump(){this.blockedJump||("whip"===this.state&&this.resetSprite(),this.isJumping=!0,this.blockedJump=!0,this.blockedMovement=!1,this.fightEnds=!0,this.movingDirection="up",this.setVelocityY(-400),this.setGravityY(400),this.anims.play("jump"),this.sounds.jump.play(),"running"===this.state?this.state="runningJump":this.state="jump",this.on("animationcomplete-jump",((e,t)=>{this.state="idle",this.idle(),this.isJumping=!1})))}jumpKick(){this.fightEnds=!1,this.blockedFight=!0,this.anims.play("jumpKick",!0),this.sounds["pre-punch"].play(),this.state="jumpKick",this.on("animationcomplete-jumpKick",((e,t)=>{this.state="idle",this.idle(),this.fightEnds=!0}))}special(){if(!this.isJumping&&this.specialEnabled){this.fightEnds=!1,this.anims.stop(),this.state="special",this.specialEnabled=!1,this.scene.disableSpecialMarker(),this.scene.cameras.main.stopFollow(),this.vulnerable=!1;let e=this.x,t=this.y;this.width;let i=this.height,s="left"===this.focusTo?-1:1,a="left"===this.focusTo;this.sounds.special.play(),this.setVelocityX(0),this.setVisible(!1);let h=this.scene.physics.add.sprite(e+3,t-i/2+3,"special");h.setSize(this.originalWidth,this.originalHeight),h.setDepth(5),h.setFlipX(a),h.anims.play("special",!0),this.scene.tweens.add({targets:h,x:e+50*s,y:t-80,duration:2055.55,ease:"Power1",onComplete:()=>{this.scene.tweens.add({targets:h,x:e+50*s,y:t-27,duration:55.55,ease:"Power1"})}}),h.body.setAllowGravity(!1),h.setScale(.95),this.scene.time.delayedCall(2110,(()=>{"special"===this.state&&(h.setSize(h.width,h.height),this.state="specialExplosion",this.sounds.explosion.play(),this.body.setSize(128,64),this.scene.cameras.main.shake(100,.05))})),h.on("animationcomplete-special",(()=>{this.resetSprite(),this.setVisible(!0),this.state="idle",this.idle(),this.vulnerable=!0,this.fightEnds=!0,this.blockedMovement=!1,h.destroy(),this.setPosition(e+50*s,t+10),this.originalX=this.x,this.originalY=this.y}))}}land(){this.isJumping=!1,this.anims.play({key:"land",frameRate:15},!0),this.sounds.land.play(),this.state="landing",this.on("animationcomplete-land",((e,t)=>{this.state="idle",this.idle(),this.movingDirection=this.focusTo,this.blockedMovement=!1}))}runCombo(e){switch(e){case"combo1":this.punch2();break;case"combo2":this.burst();break;case"combo3":this.kick()}}addSounds(){["pre-punch","player-punch","player-fire","jump","land","hurt","shield","boomerang","whip","hit","special","explosion","chest","item","increase","error"].forEach((e=>{this.sounds[e]=this.scene.sound.add(e)}))}startBlink(e){this.scene.tweens.add({targets:this,alpha:.3,ease:"Linear",duration:200,yoyo:!0,repeat:e-1,onComplete:()=>{this.setAlpha(1)}})}}class c extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(0,0,"splash").setOrigin(0),this.addProgressBar()}preload(){this.load.setPath("assets"),this.loadAudios(),this.loadBgImages(),this.loadHudImages(),this.loadSpriteSheets(),this.loadTileMaps(),this.loadFXSprites()}create(){d.createAnimations(this),h.createAnimations(this),r.createAnimations(this),o.createAnimations(this),this.defineFXAnimations(),this.scene.start("MainMenu")}defineFXAnimations(){this.anims.create({key:"explosion1",frames:this.anims.generateFrameNumbers("explosion1",{start:0,end:11}),frameRate:24,repeat:0})}addProgressBar(){this.add.rectangle(200,150,300,31).setStrokeStyle(1,0);const e=this.add.rectangle(200,150,298,30,16181248);this.load.on("progress",(t=>{e.width=4+300*t}))}loadAudios(){["enemy-die","enemy-shot","enemy-punch","pre-punch","player-punch","player-fire","jump","land","hurt","shield","boomerang","whip","hit","special","explosion","chest","item","increase","error"].forEach((e=>{this.load.audio(e,`sounds/${e}.mp3`)})),this.load.audio("bitest","sounds/bitest.mp3")}loadSpriteSheets(){this.captainSprites(),h.loadResources(this),r.loadResources(this),this.boxSprites(),this.uiImages()}loadBgImages(){this.load.image("bullet","sprites/captain/bullet.png"),this.load.image("bg1","background/1.png"),this.load.image("bg2","background/2.png"),this.load.image("bg3","background/3.png"),this.load.image("bg4","background/4.png"),this.load.image("bg5","background/5.png")}loadHudImages(){this.load.image("specialMarker","ui/special.png"),this.load.image("healthIcon","ui/health.png"),this.load.image("powerIcon","ui/power.png")}loadTileMaps(){this.load.image("tilemapImage2","tiles/greenTiles2.png"),this.load.image("objectsTilemap","tiles/newObjectSet.png"),this.load.tilemapTiledJSON("tilemapJson","tiles/world.json")}captainSprites(){this.load.spritesheet("captain-idle","sprites/captain/idle.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-run","sprites/captain/run.png",{frameWidth:64,frameHeight:58}),this.load.spritesheet("captain-fight","sprites/captain/fight.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("shield-throw","sprites/captain/shield-throw.png",{frameWidth:75,frameHeight:64}),this.load.spritesheet("shield-fly","sprites/captain/shield-fly.png",{frameWidth:64,frameHeight:40}),this.load.spritesheet("special","sprites/captain/special.png",{frameWidth:128,frameHeight:92}),this.load.spritesheet("whip","sprites/captain/whip.png",{frameWidth:135,frameHeight:64}),this.load.aseprite({key:"shot",textureURL:"sprites/captain/shot.png",atlasURL:"sprites/captain/shot.json"})}loadFXSprites(){this.load.spritesheet("explosion1","sprites/fx/explosion1.png",{frameWidth:25,frameHeight:24})}boxSprites(){this.load.spritesheet("chest","sprites/boxes/chest.png",{frameWidth:32,frameHeight:32})}uiImages(){this.load.image("power","sprites/boxes/power.png"),this.load.image("health","sprites/boxes/health.png"),this.load.image("ammo","sprites/boxes/ammo.png")}}class p extends i.Scene{constructor(){super("MainMenu")}init(e){this.inputHandler=e.inputHandler||!1}create(){let e,t,i,s=0,a=0,h=this.game.config.width,n=this.game.config.height,r=1;if(this.inputHandler){if(t=this.inputHandler.width||h,i=this.inputHandler.height||n,e=this.inputHandler.screenSize,r=t/h,s=h===t?0:(t-h)/2,a=n===i?0:(i-n)/2,this.inputHandler.isMobile)switch(this.inputHandler.orientation){case"portrait":s=0,a=(e.height-i)/2;break;case"landscape":s=(e.width-t)/2,a=0}console.log("bg size",{bgWidth:t,bgHeight:i}),console.log("game size",{gamewidth:h,gameheight:n})}console.log("main menu",this),this.add.image(s,a,"splash").setOrigin(0).setScale(r);let o=this.inputHandler.isMobile?s+t/2:s+h/2,l=this.inputHandler.isMobile?a+i/2:a+n/2;this.add.text(o,l,"Click / Touch to Start",{fontFamily:"Courier",fontSize:15,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.cameras.main.fadeOut(250,0,0,0),this.cameras.main.once("camerafadeoutcomplete",(function(e){this.scene.start("Game")}),this)}))}}class m{constructor(e){t(this,"buttons",{A:!1,B:!1,X:!1,Y:!1}),t(this,"holding",{q:!1,e:!1,X:!1,Y:!1}),t(this,"holdingTime",500),t(this,"maxComboTime",500),t(this,"combo",!1),t(this,"isHolding",!1),t(this,"canBeHold",!1),t(this,"isMobile",!0),t(this,"orientation"),t(this,"screeSize"),t(this,"lastKeyPressed"),this.scene=e,this.cursors=e.input.keyboard.createCursorKeys(),this.wKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.aKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.sKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.dKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.qKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q),this.eKey=e.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.E),this.emitter=new Phaser.Events.EventEmitter,this.createCombos(),this.isMobile&&(this.scene.game.scene.start("UIScene",{inputHandler:this}),this.resizeGame({width:this.scene.scale.width,height:this.scene.scale.height}),this.scene.scale.updateCenter()),this.scene.input.keyboard.on("keydown",(e=>{this.combo||this.checkKeysDown(e.key)})),this.scene.input.keyboard.on("keyup",(e=>{this.combo&&(this.combo=!1),this.checkKeysUp(e.key)}))}checkKeysDown(e){switch(this.lastKeyPressed=e,e){case"w":case"A":case"ArrowUp":this.emitter.emit("jumpKeyPressed");break;case"a":case"d":case"ArrowLeft":case"ArrowRight":case"joystick":this.emitter.emit("moveKeyPressed");break;case"q":case"e":this.lastKeyPressed=e,this.canBeHold=!0;case"X":case"Y":case"B":case" ":this.emitter.emit("fightActionPressed")}}checkKeysUp(e){switch(e){case"w":case"A":case"ArrowUp":this.emitter.emit("jumpKeyLeaved");break;case"a":case"d":case"ArrowLeft":case"ArrowRight":this.emitter.emit("movingKeyUp");break;case"q":case"e":this.canBeHold=!1,this.holding[e]=!1;case"X":case"Y":case" ":case"B":this.emitter.emit("fightActionLeaved")}}holdingCheck(e=this.lastKeyPressed){"e"!==e&&"q"!==e||{q:this.qKey,e:this.eKey}[e].getDuration()>=this.holdingTime&&(this.holding[e]=!0,this.emitter.emit("holdAction"))}isMobileDevice(){const e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)||/iPad|iPhone|iPod/.test(e)&&!window.MSStream}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}resizeGame({width:e,height:t}){this.screenSize={width:e,height:t};const i=4/3;let s,a,h;e/t>i?(a=t,s=t*i,this.orientation="landscape"):(s=e,a=e/i,this.orientation="portrait"),this.width=s,this.height=a,h=Math.min(s/this.scene.game.config.width,a/this.scene.game.config.height),this.scene.cameras.main.setZoom(h),this.scene.cameras.main.setViewport((e-s)/2,(t-a)/2,s,a),this.scene.cameras.main.setBounds(0,0,this.scene.game.config.width,this.scene.game.config.height)}setButtonState(e,t){this.buttons[e]=t}setJoystickCursor(e){const t=this.scene.plugins.get("rexVirtualJoystick");t?(this.joystick=t.add(this.scene,e),this.joystickKeys=this.joystick.createCursorKeys(),this.joystick.on("pointerdown",(()=>{this.emitter.emit("moveKeyPressed")})),this.joystick.on("update",(()=>{this.checkKeysDown("joystick")})),this.joystick.on("pointerup",(()=>{this.emitter.emit("movingKeyUp")}))):console.error("Plugin rexVirtualJoystick no encontrado")}createCombos(){let e=[Phaser.Input.Keyboard.KeyCodes.SPACE,Phaser.Input.Keyboard.KeyCodes.E],t=[Phaser.Input.Keyboard.KeyCodes.SPACE,Phaser.Input.Keyboard.KeyCodes.SPACE];this.scene.input.keyboard.createCombo(e,{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.createCombo(t,{resetOnMatch:!0,maxKeyDelay:this.maxComboTime}),this.scene.input.keyboard.on("keycombomatch",(e=>{32===e.keyCodes[0]&&69===e.keyCodes[1]&&this.runCombo("combo2"),32===e.keyCodes[0]&&32===e.keyCodes[1]&&this.runCombo("combo3")}))}runCombo(e){this.combo=!0,this.scene.player.runCombo(e)}}class u extends i.Scene{constructor(){super("Game"),t(this,"player"),t(this,"inputHandler"),t(this,"score",0),t(this,"textScore"),t(this,"lives",3),t(this,"textLives"),t(this,"map"),t(this,"enemies"),t(this,"groundLayer"),t(this,"healthBar"),t(this,"guideIsOpen",!1),t(this,"boxesEnabled",{})}create(){this.cameras.main.fadeIn(200,0,0,0),this.player=new d(this,100,400,"captain-idle"),this.inputHandler=new m(this),this.addBackground(),this.playMusic(),this.addTileMaps(),this.createCamera(),this.createEnemies(),this.createAnimals(),this.enableDomGuide(),this.eventListeners(),console.log("game scene",this)}update(e,t){this.frameCount=(this.frameCount||0)+1;let i=this.game.loop.actualFps<50?4:1;this.frameCount%i==0&&(this.player.body.velocity.y<=-20?this.player.movingDirection="down":0===this.player.body.velocity.x&&this.player.body.blocked.down&&(this.player.movingDirection="none"),"down"===this.player.movingDirection&&this.player.body.blocked.down&&this.player.fightEnds&&(this.player.land(),this.player.movingDirection="none"),this.handleBurstAnimation(),this.landEnemies&&this.updateChars(this.landEnemies),this.flyingEnemies&&this.updateChars(this.flyingEnemies),this.flyingAnimals&&this.updateChars(this.flyingAnimals),this.landAnimals&&this.updateChars(this.landAnimals),this.player.x>3150&&this.player.y<70&&this.finishGame(),this.inputHandler.canBeHold&&this.inputHandler.holdingCheck()),this.player.isMoving&&this.handleMovement()}eventListeners(){this.inputHandler.emitter.on("fightActionPressed",this.handleFightActions,this),this.inputHandler.emitter.on("jumpKeyPressed",this.handleJump,this),this.inputHandler.emitter.on("moveKeyPressed",this.handleMovement,this),this.inputHandler.emitter.on("fightActionLeaved",this.handleFightLeaved,this),this.inputHandler.emitter.on("jumpKeyLeaved",this.jumpLeaved,this),this.inputHandler.emitter.on("movingKeyUp",this.moveLeaved,this),this.inputHandler.emitter.on("holdAction",this.holdingAction,this)}enableDomGuide(){const e=document.querySelector("#guideButton");e.classList.add("visible"),e.addEventListener("pointerdown",(()=>{this.guideIsOpen?(this.scene.resume(),this.guideIsOpen=!1):(this.scene.pause(),this.guideIsOpen=!0)}))}holdingAction(){(this.inputHandler.holding.X||this.inputHandler.holding.q)&&this.player.shieldAttack(),(this.inputHandler.holding.Y||this.inputHandler.holding.e)&&this.player.special(),this.inputHandler.canBeHold=!1}endGame(){this.music.stop(),this.scene.start("GameOver",{inputHandler:this.inputHandler})}updateChars(e){const t=e.getChildren();for(let i=0;i<t.length;i++){const e=t[i];this.isCharInCameraView(e,this.cameras.main.worldView)&&e.update()}}handleJump(){this.player.body.blocked.down&&this.player.handleJump()}jumpLeaved(){this.player.blockedJump=!1}handleFightActions(){"down"===this.player.movingDirection?this.player.jumpKick():this.inputHandler.qKey.isDown||this.inputHandler.buttons.X?this.player.shieldHit():this.inputHandler.cursors.space.isDown||this.inputHandler.buttons.B?this.player.punch():(this.inputHandler.eKey.isDown||this.inputHandler.buttons.Y)&&(this.player.power>=25&&"burst"!==this.player.state?this.player.whip():this.powerBarBlick())}handleFightLeaved(){this.player.blockedFight=!1}handleBurstAnimation(){if("burst"===this.player.state){const e=this.player.anims.currentFrame;e.index>=3&&e.index%2==1?this.player.bulletFired||(this.player.fireBullet(this),this.player.bulletFired=!0):this.player.bulletFired=!1}else this.player.bulletFired=!1}hitEnemy(e,t){e.hurt(t)}handleMovement(){var e,t;this.player.isMoving=!0,this.inputHandler.cursors.left.isDown||this.inputHandler.aKey.isDown||(null==(e=this.inputHandler.joystickKeys)?void 0:e.left.isDown)?(this.player.move("left"),this.moveBackground(-1)):(this.inputHandler.cursors.right.isDown||this.inputHandler.dKey.isDown||(null==(t=this.inputHandler.joystickKeys)?void 0:t.right.isDown))&&(this.player.move("right"),this.moveBackground(1))}moveLeaved(){this.inputHandler.aKey.isDown||this.inputHandler.dKey.isDown||this.inputHandler.cursors.left.isDown||this.inputHandler.cursors.right.isDown||(this.player.isMoving=!1,this.player.idle())}createEnemies(){this.landEnemies=this.physics.add.group(),this.flyingEnemies=this.physics.add.group({allowGravity:!1}),this.map.getObjectLayer("enemies").objects.forEach((e=>{let t=new h(this,e.x,e.y,e.name);this.physics.add.collider(this.walls,t),this.physics.add.overlap(this.player,t,this.handleBodyCollision,null,this),t.fly?this.flyingEnemies.add(t):(this.landEnemies.add(t),this.physics.add.collider(this.greenTilesLayer,t)),t.shot&&(this.physics.add.overlap(t.bullets,this.player,this.playerFired,null,this),this.physics.add.collider(t.bullets,this.greenTilesLayer,this.destroyBullet,null,this),this.physics.add.collider(t.bullets,this.walls,this.destroyBullet,null,this))})),this.physics.add.collider(this.landEnemies,this.landEnemies,null,null,this),this.physics.add.collider(this.player.bullets,this.landEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.player.bullets,this.flyingEnemies,this.handleBulletCollision,null,this),this.physics.add.collider(this.player.bullets,this.greenTilesLayer,this.destroyBullet,null,this),this.physics.add.collider(this.player.bullets,this.walls,this.destroyBullet,null,this)}createAnimals(){this.landAnimals=this.physics.add.group(),this.flyingAnimals=this.physics.add.group({allowGravity:!1}),this.map.getObjectLayer("animals").objects.forEach((e=>{var t;let i=!1;null==(t=e.properties)||t.forEach((e=>{"flip"===e.name&&(i=e.value)}));let s=new r(this,e.x,e.y,e.name,i);s.fly?this.flyingAnimals.add(s):(this.landAnimals.add(s),this.physics.add.collider(this.greenTilesLayer,s))})),this.physics.add.collider(this.flyingAnimals,this.walls),this.physics.add.collider(this.landAnimals,this.walls)}isCharInCameraView(e,t){return e.x+e.width>t.x&&e.x<t.x+t.width&&e.y+e.height>t.y&&e.y<t.y+t.height}destroyBullet(e,t){e.destroy();let i=this.physics.add.sprite(e.x,e.y,"explosion1");i.setDepth(5),i.body.setAllowGravity(!1),i.anims.play("explosion1"),i.on("animationcomplete-explosion1",((e,t)=>{i.destroy()}))}playerFired(e,t){this.player.vulnerable&&"special"!==this.player.state&&(this.player.vulnerable=!1,this.player.takeDamage(t.damage),this.healthbarUpdate(),this.destroyBullet(t),this.player.sounds.hit.play()),this.time.delayedCall(1e3,(()=>{this.player.vulnerable=!0}))}handleBulletCollision(e,t){this.hitEnemy(t,20),this.player.sounds.hit.play(),"bullet"===e.texture.key&&e.destroy()}handleHitCollision(e,t){this.hitEnemy(t)}handleBodyCollision(e,t){let i=this.player.state;switch(i){case"kick":this.player.sounds.hit.play();case"jumpKick":this.player.sounds.hit.play();case"punch":this.player.sounds["player-punch"].play();break;case"throw":this.player.sounds.shield.play()}let s="right"===e.focusTo?e.x<=t.x:e.x>=t.x;if(["punch","kick","whip","specialExplosion","shield"].includes(i)&&s&&this.hitEnemy(t,{punch:25,kick:35,shield:50,whip:100,specialExplosion:150}[i]),"attacking"===t.state&&!t.attackDone&&this.player.vulnerable){let e=t.damage||0;this.player.takeDamage(e),this.player.vulnerable=!1,this.healthbarUpdate(),this.time.delayedCall(800,(()=>{this.player.vulnerable=!0}))}}playMusic(){this.music=this.sound.add("bitest"),this.music.play(),this.music.setLoop(!0)}addBackground(){let e=this.game.config.width,t=this.game.config.height,i=this.inputHandler.width||e,s=this.inputHandler.height||t,a=e===i?0:(i-e)/2,h=t===s?0:(s-t)/2;this.bg1=this.add.tileSprite(a,h,e,t,"bg1").setScrollFactor(0).setOrigin(0,0),this.bg2=this.add.tileSprite(a,h,e,t,"bg2").setScrollFactor(0).setOrigin(0,0),this.bg3=this.add.tileSprite(a,h,e,t,"bg3").setScrollFactor(0).setOrigin(0,0),this.bg4=this.add.tileSprite(a,h,e,t,"bg4").setScrollFactor(0).setOrigin(0,0),this.bg5=this.add.tileSprite(a,h,e,t,"bg5").setScrollFactor(0).setOrigin(0,0),this.addUiContainer(a,h,e)}moveBackground(e){let t=this.cameras.main.scrollX/20;this.bg1.tilePositionX=.2*t,this.bg2.tilePositionX=.5*t,this.bg3.tilePositionX=1*t,this.bg4.tilePositionX=2*t,this.bg5.tilePositionX=3*t}createCamera(){this.physics.world.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels),this.cameras.main.setBounds(0,0,this.map.widthInPixels,this.map.heightInPixels).startFollow(this.player,!0,1,.1,0,0).setFollowOffset(0,-50)}addTileMaps(){this.map=this.make.tilemap({key:"tilemapJson"});const e=this.map.addTilesetImage("greenTiles2","tilemapImage2");this.greenTilesLayer=this.map.createLayer("greenPlatforms",e),this.walls=this.map.createLayer("walls",e),this.walls.setDepth(1).setCollisionByProperty({collider:!0}),this.physics.add.collider(this.player,this.walls);const t=this.map.addTilesetImage("newObjectSet","objectsTilemap"),i=this.map.createLayer("background",t),s=this.map.createLayer("buildings",t),a=this.map.createLayer("farBackground",t),h=this.map.createLayer("foreground",t);a.setDepth(0),s.setDepth(2),i.setDepth(4),h.setDepth(5),this.greenTilesLayer.setDepth(3).setCollisionByProperty({collider:!0}),this.physics.add.collider(this.player,this.greenTilesLayer,null,(function(e,t){return e.body.velocity.y>0}));let n=this.physics.add.group();this.map.getObjectLayer("boxes").objects.forEach((e=>{let t,i;this.boxesEnabled[e.id]=!0,e.properties.forEach((e=>{switch(e.name){case"potion":t=e.value;break;case"flip":i=e.value}}));let s=new o(this,e.x,e.y,"chest",t,i);s.id=e.id,n.add(s),this.physics.add.overlap(this.player,s.potions,this.collectPotion,null,this)})),n.setDepth(5),this.physics.add.collider(this.greenTilesLayer,n),this.physics.add.collider(this.walls,n),this.physics.add.overlap(this.player,n,this.boxInteraction,null,this)}boxInteraction(e,t){!this.player.fightEnds&&this.boxesEnabled[t.id]&&(this.boxesEnabled[t.id]=!1,t.openBox(),this.player.sounds.chest.play())}collectPotion(e,t){if(!t.collected){t.collected=!0,t.removeCollidesWith(this.player),this.time.delayedCall(200,(()=>{t.body.setVelocityY(-200)}));let e=!1;switch(t.name){case"health":if(this.player.health<100){let i=this.player.health+t.amount<=100?this.player.health+t.amount:100;this.player.health=i,this.healthbarUpdate(),e=!0,this.uiBlink(this.healthBar)}break;case"power":if(this.player.power<100){let i=this.player.power+t.amount<=100?this.player.power+t.amount:100;this.player.power=i,this.powerbarUpdate(),e=!0,this.uiBlink(this.powerBar)}break;case"ammo":this.player.ammoEnabled||(this.player.ammoEnabled=!0,this.enableAmmoMarker(),e=!0,this.uiBlink(this.ammoMarker))}e&&this.player.sounds.item.play(),this.time.delayedCall(500,(()=>{this.player.sounds.increase.setVolume(.3).play(),t.destroy()}))}}addUiContainer(e,t,i){this.uiContainer=this.add.container(e,t),this.uiContainer.setScrollFactor(0).setDepth(6),this.addHealthBar(),this.addPowerBar(i),this.addSpecialUI(i/2),this.addAmmoUI(i/2)}addHealthBar(){let e=this.player.health,t=this.add.graphics();t.fillStyle(0,1).setAlpha(.3).fillRect(10,10,e,15),this.healthBar=this.add.graphics(),this.healthBar.fillStyle(51017,1).fillRect(10,10,e,15),this.uiContainer.add(t),this.uiContainer.add(this.healthBar);let i=this.add.image(12,11,"healthIcon").setOrigin(0);this.uiContainer.add(i)}addPowerBar(e){let t=this.player.power;this.powerbarBackground=this.add.graphics();let i=e-10-t;this.powerbarBackground.fillStyle(0,1).setAlpha(.3).fillRect(i,10,t,15),this.powerBar=this.add.graphics(),this.powerBar.fillStyle(16509184,1).fillRect(i,10,t,15),this.powerBar.position=i,this.uiContainer.add(this.powerbarBackground),this.uiContainer.add(this.powerBar);let s=this.add.image(i+2,11,"powerIcon").setOrigin(0);this.uiContainer.add(s)}powerbarUpdate(){this.powerBar.clear(),this.player.power>0&&this.powerBar.fillStyle(16509184,1).fillRect(this.powerBar.position,10,this.player.power,15)}powerBarBlick(e=3){this.player.sounds.error.play(),this.tweens.add({targets:this.powerbarBackground,alpha:0,ease:"Linear",duration:200,yoyo:!0,repeat:e-1,onComplete:()=>{this.powerbarBackground.setAlpha(1)}})}uiBlink(e,t=3,i=!1){this.tweens.add({targets:e,alpha:0,ease:"Linear",duration:200,yoyo:!0,repeat:t-1,onComplete:()=>{i?e.setAlpha(.5):e.setAlpha(1)}})}healthbarUpdate(){this.healthBar.clear(),this.healthBar.fillStyle(51017,1).fillRect(10,10,this.player.health,15),this.player.health<=0&&this.endGame()}addSpecialUI(e){let t=e-20;this.specialMarker=this.add.image(t,20,"specialMarker"),this.specialMarker.setScale(.4),this.specialMarker.setOrigin(.5),this.uiContainer.add(this.specialMarker)}addAmmoUI(e){let t=e+20;this.ammoMarker=this.add.image(t,20,"ammo"),this.ammoMarker.setOrigin(.5),this.uiContainer.add(this.ammoMarker)}disableSpecialMarker(){this.specialMarker.setAlpha(.5)}enableAmmoMarker(){this.ammoMarker.setAlpha(1)}disableAmmoMarker(){this.ammoMarker.setAlpha(.5)}finishGame(){this.cameras.main.fadeOut(250,0,0,0),this.scene.start("Finish",{inputHandler:this.inputHandler})}}class y extends Phaser.Scene{constructor(){super({key:"UIScene",transparent:!0}),this.width,this.height,this.isPortrait,this.comboSequences=[],this.comboTimeout=null,this.comboList=[{sequence:["B","Y"],action:"combo2"},{sequence:["B","B"],action:"combo3"}]}init(e){this.inputHandler=e.inputHandler}create(){console.log("UI scene",this),this.width=this.scale.parentSize.width,this.height=this.scale.parentSize.height,this.isPortrait=this.width<this.height,this.scale.setGameSize(this.width,this.height),this.addVirtualJoystick(),this.addVirtualButtons()}addVirtualJoystick(){const e=this.isPortrait?.06*this.width:.1*this.width,t=this.isPortrait?(this.width-2*e)/4:100,i=this.isPortrait?t+e:t+e/4,s=this.height-t-e,a={x:i,y:s,radius:t,base:this.add.circle(i,s,t,8947848).setAlpha(.5),thumb:this.add.circle(i,s,t/2,13421772).setAlpha(.8),dir:"4dir",fixed:!0,enable:!0};this.inputHandler.setJoystickCursor(a)}addVirtualButtons(){const e=Math.min(30,.09*this.width),t={x:this.width-3.3*e,y:this.isPortrait?this.height-3.5*e:this.height/2+2*e};[{key:"A",x:t.x,y:t.y+1.7*e},{key:"B",x:t.x+1.7*e,y:t.y},{key:"X",x:t.x-1.7*e,y:t.y},{key:"Y",x:t.x,y:t.y-1.7*e}].forEach((t=>{const i=this.add.circle(t.x,t.y,e).setStrokeStyle(2,16711680).setFillStyle(0).setInteractive().on("pointerdown",(()=>this.onButtonDown(t.key,i))).on("pointerup",(()=>this.onButtonUp(t.key,i)));this.add.text(t.x,t.y,t.key,{fontFamily:"Arial Black",fontSize:20,color:"#ffffff",align:"center"}).setOrigin(.5)}))}handleResize(e){e.width,e.height,this.scene.restart()}onButtonDown(e,t){t.setFillStyle(16711680),this.inputHandler.setButtonState(e,!0),this.recordKeyPress(e),this.time.delayedCall(this.inputHandler.holdingTime,(()=>{this.inputHandler.buttons[e]&&(this.inputHandler.holding[e]=!0,this.inputHandler.emitter.emit("holdAction"))})),this.inputHandler.checkKeysDown(e)}onButtonUp(e,t){t.setFillStyle(0),this.inputHandler.setButtonState(e,!1),this.inputHandler.holding[e]=!1,this.inputHandler.checkKeysUp(e)}recordKeyPress(e){this.comboTimeout&&clearTimeout(this.comboTimeout),this.comboSequences.push(e),this.checkCombo(),this.comboTimeout=setTimeout((()=>{this.comboSequences=[]}),this.inputHandler.maxComboTime)}checkCombo(){for(let e of this.comboList)if(this.isComboMatch(e.sequence)){this.inputHandler.runCombo(e.action),this.comboSequences=[];break}}isComboMatch(e){if(this.comboSequences.length<e.length)return!1;const t=this.comboSequences.slice(-e.length);return e.every(((e,i)=>e===t[i]))}}class g extends i.Scene{constructor(){super("GameOver")}init(e){this.inputHandler=e.inputHandler}preload(){this.load.image("flag","assets/jamaica-flag.png")}create(){var e,t,i,s;console.log("game over",this);let a={fontFamily:"Courier",fontSize:100,color:"#f6e800",stroke:"#000000",strokeThickness:8,align:"center"},h=this.game.config.width,n=this.game.config.height,r=(null==(e=this.inputHandler)?void 0:e.width)||h,o=(null==(t=this.inputHandler)?void 0:t.height)||n,l=(null==(i=this.inputHandler)?void 0:i.screenSize)||{width:h,height:n},d=h===r?0:(r-h)/2,c=n===o?0:(o-n)/2,p=r/h;if(null==(s=this.inputHandler)?void 0:s.isMobile)switch(this.inputHandler.orientation){case"portrait":d=0,c=(l.height-o)/2;break;case"landscape":d=(l.width-r)/2,c=0}this.add.image(d,c,"flag").setOrigin(0).setAlpha(.8).setScale(p);let m=this.add.text(l.width/2,l.height/2-30,"Game",a).setOrigin(.5),u=this.add.text(l.width/2,l.height/2+30,"Over",a).setOrigin(.5);this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:e=>{const t=e.getValue();m.setFontSize(20+64*t)}}),this.tweens.addCounter({from:0,to:1,duration:3e3,yoyo:!1,onUpdate:e=>{const t=e.getValue();u.setFontSize(20+64*t)},onComplete:()=>{m.destroy(),u.destroy(),this.addCredits(l),this.addRestartButton(l)}})}addRestartButton(e){let t=this.add.text(e.width/2,e.height/2+100,"RESTART",{fontFamily:"Courier",fontSize:20,color:"#000",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.scene.start("MainMenu",{inputHandler:this.inputHandler})}));this.tweens.add({targets:t,duration:500,y:e.height/2+105,yoyo:!0,repeat:-1})}addCredits(e){var t;let i={fontFamily:"Courier",fontSize:(null==(t=this.inputHandler)?void 0:t.isMobile)&&"portrait"===this.inputHandler.orientation?e.width/40:e.height/25,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"};this.add.text(e.width/2,e.height/2-30,"Credits \nOriginal History & Main Char Design & Animations: \nOral Ferguson \n\nPrograming, Music & Sound:\nAlan Reibel\n\nOther Graphics (Backgrounds, Tiles & Enemies): \ncraftpix.net\n\nTypewriter Sounds:\npixabay.com\n",i).setOrigin(.5).setWordWrapWidth(e.width-40)}}class f extends i.Scene{constructor(){super("Finish")}init(e){this.inputHandler=e.inputHandler}preload(){this.load.image("finish","assets/finish.png")}create(){var e,t,i,s;console.log("Finish",this);let a=this.game.config.width,h=this.game.config.height,n=(null==(e=this.inputHandler)?void 0:e.width)||a,r=(null==(t=this.inputHandler)||t.height,(null==(i=this.inputHandler)?void 0:i.screenSize)||{width:a,height:h}),o=n/a;if(console.log("scale",o),console.log("bgWidth",n),console.log("gamewidth",a),null==(s=this.inputHandler)?void 0:s.isMobile)switch(this.inputHandler.orientation){case"portrait":r.height;break;case"landscape":r.width}let l={fontFamily:"Courier",fontSize:20,color:"#f6e800",stroke:"#000000",strokeThickness:8,align:"center"};this.add.image(r.width/2,r.height/2,"finish").setAlpha(.8).setScale(o);let d=this.add.text(r.width/2,r.height/2-30,"Congrats!",{...l,fontSize:40}).setOrigin(.5),c=this.add.text(r.width/2,r.height/2+30,"You have successfully finished!",l).setOrigin(.5);this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:e=>{const t=e.getValue();d.setFontSize(30+10*t)}}),this.tweens.addCounter({from:0,to:1,duration:1e3,yoyo:!1,onUpdate:e=>{const t=e.getValue();c.setFontSize(10+10*t)},onComplete:()=>{this.addRestartButton(r)}})}addRestartButton(e){let t=this.add.text(e.width/2,e.height/2+100,"RESTART",{fontFamily:"Courier",fontSize:25,color:"#f6e800",stroke:"#000000",strokeThickness:2,align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.game.sound.stopAll(),this.scene.start("MainMenu",{inputHandler:this.inputHandler})}));this.tweens.add({targets:t,duration:500,y:e.height/2+105,yoyo:!0,repeat:-1})}addCredits(e){var t;let i={fontFamily:"Courier",fontSize:(null==(t=this.inputHandler)?void 0:t.isMobile)&&"portrait"===this.inputHandler.orientation?e.width/40:e.height/25,color:"#f6e800",stroke:"#000000",strokeThickness:5,align:"center"};this.add.text(e.width/2,e.height/2-30,"Credits \nOriginal History & Main Char Design & Animations: \nOral Ferguson \n\nPrograming, Music & Sound:\nAlan Reibel\n\nOther Graphics (Backgrounds, Tiles & Enemies): \ncraftpix.net\n\nTypewriter Sounds:\npixabay.com\n",i).setOrigin(.5).setWordWrapWidth(e.width/2)}}class b extends i.Scene{constructor(){super("Intro"),this.lines=[],this.maxLines=5,this.fullText={es:"\nEn un mundo devastado por interminables batallas, \ndonde la mitad de la poblacin ha desaparecido sin \ndejar rastro, el caos se ha apoderado de Jamaica. \nLas bandas de capos opresores han tomado el control, \nsumiendo la isla en un estado de anarqua.\n\nNuestro protagonista, un individuo resistente y \ndeterminado, se encontr en medio de este tumulto. \n\nEn medio de los saqueos, un hombre armado le dispar, \ndejndolo al borde de la muerte. La desesperacin \ny el miedo se apoderaron de l mientras yaca en \nel suelo, rodeado por el caos del momento.\n\nPero la esperanza no estaba completamente perdida. \nEn la misma ciudad, una anciana famosa por su \nconocimiento sobre hierbas msticas decidi intervenir. \nCon sus habilidades, cre un elixir nico, una pocin \nque combinaba plantas raras y mgicas. \n\nAl administrrselo, las heridas comenzaron a sanar. \nSin embargo, el elixir tuvo efectos secundarios: \nle otorg una fuerza sobrehumana, velocidad y \ndurabilidad ms all de lo imaginable.\n\nRenacido con estos nuevos poderes, el protagonista \nse enfrenta ahora a un dilema. Utilizar sus habilidades \npara restaurar el orden en Jamaica y liberar a su gente \ndel yugo de los capos opresores...\n\no se perder en la sed de venganza y poder?",en:"\nIn a world devastated by endless battles, where half \nof the population has vanished without a trace, chaos \nhas taken over Jamaica. Oppressive gangs have seized \ncontrol, plunging the island into a state of anarchy.\n\nOur protagonist, a resilient and determined individual, \nfound himself in the midst of this turmoil. \n\nAmidst the looting, an armed man shot him, leaving him \non the brink of death. Desperation and fear consumed \nhim as he lay on the ground, surrounded by the chaos \nunfolding around him.\n\nBut hope was not entirely lost. In the same city, an elderly\nwoman known for her knowledge of mystical herbs \ndecided to intervene. With her skills, she created a unique \nelixir, a potion that combined rare and magical plants. \n\nUpon administering it, his wounds began to heal rapidly. \nHowever, the elixir had unexpected side effects: \nit granted him superhuman strength, speed, and durability \nbeyond imagination.\n\nReborn with these new powers, the protagonist now \nfaces a dilemma. Will he use his abilities to restore order\nin Jamaica and free his people from the oppressive ...\nor will he be consumed by the thirst for revenge and power?\n\nThe fate of Jamaica lies in his hands. \nThe battle for justice has only just begun."},this.imageList=["devasted-city","shoting","lying","elixir","effects","reborn"],this.currentLineIndex=0,this.typing=!1,this.speed=50,this.images={es:{5:"shoting",10:"lying",15:"elixir",20:"effects",25:"reborn"},en:{4:"shoting",9:"lying",14:"elixir",18:"effects",23:"reborn"}}}create(){const e=(navigator.language||navigator.userLanguage).substring(0,2);this.textArray=this.fullText[e].split("\n"),this.userLanguage=e;const t=this.game.config.width-40,i=this.game.config.height/2,s={fontSize:"14px",fontFamily:"Arial",fill:"#ffffff",wordWrap:{width:t,useAdvancedWrap:!0}};this.text=this.add.text(20,i+30,"",s),this.addInitialLines(),this.time.addEvent({delay:1600,callback:()=>{this.typing||(this.addNextLine(),this.lines.length>this.maxLines&&this.scrollText())},loop:!0}),this.keySounds=[this.sound.add("keySound1"),this.sound.add("keySound2"),this.sound.add("keySound3")],this.spaceSound=this.sound.add("spaceSound"),this.enterSound=this.sound.add("enterSound"),this.introMusic=this.sound.add("introMusic"),this.introMusic.play({volume:.9,loop:!1}),this.addSkipButton()}shutdown(){this.cleanup()}destroy(){this.cleanup()}cleanup(){this.introImage1&&this.introImage1.destroy(!0),this.introImage2&&this.introImage2.destroy(!0),this.imageList.forEach((e=>{this.textures.remove(e)})),this.keySounds.forEach((e=>{e.destroy()})),this.introMusic.destroy(),this.spaceSound.destroy(),this.enterSound.destroy()}addSkipButton(){let e=this.game.config.width,t=this.game.config.height;this.skip=this.add.text(e-30,t-10,"SKIP",{fontFamily:"Courier",fontSize:15,color:"#ffffff",align:"center"}).setOrigin(.5).setInteractive().on("pointerdown",(()=>{this.endIntro()})),this.tweens.add({targets:this.skip,duration:300,y:t-15,yoyo:!0,repeat:-1})}endIntro(){console.log("intro",this),this.cameras.main.fadeOut(250,0,0,0),this.game.sound.stopAll(),this.cameras.main.once("camerafadeoutcomplete",(function(e){this.scene.start("Preloader")}),this)}addInitialLines(){this.currentLineIndex<this.textArray.length&&(this.addLineWithTypewriterEffect(this.textArray[this.currentLineIndex]),this.currentLineIndex++,this.addImage("devasted-city"))}addNextLine(){if(this.currentLineIndex<this.textArray.length){if(Object.keys(this.images[this.userLanguage]).includes(`${this.currentLineIndex}`)){let e=this.images[this.userLanguage][this.currentLineIndex];this.addImage(e)}this.addLineWithTypewriterEffect(this.textArray[this.currentLineIndex]),this.currentLineIndex++}else this.endIntro()}addLineWithTypewriterEffect(e){this.typing=!0;let t=0;const i=e.length;let s="";const a=this.time.addEvent({callback:()=>{t<i?(s+=e[t],this.text.setText(this.lines.join("")+s),this.playTypingSound(e[t]),t++):(this.typing=!1,this.lines.push(`${s} \n`),this.text.setText(this.lines.join("")),this.enterSound.play(),a.remove())},delay:this.speed,callbackScope:this,loop:!0})}scrollText(){this.lines.shift(),this.text.setText(this.lines.join(""))}playTypingSound(e){" "===e?this.spaceSound.play():this.keySounds[Math.floor(Math.random()*this.keySounds.length)].play({volume:.2})}addImage(e){this.tweens.add({targets:this.introImage,alpha:0,ease:"Linear",duration:1e3,onComplete:()=>{this.introImage=this.add.image(0,0,e).setOrigin(0).setAlpha(0),this.tweens.add({targets:this.introImage,alpha:1,ease:"Linear",duration:1e3})}})}}const w=Phaser.Input.Keyboard.Key,v=Phaser.Input.Keyboard.KeyCodes;class k{constructor(e){this.cursorKeys={up:new w(e,v.UP),down:new w(e,v.DOWN),left:new w(e,v.LEFT),right:new w(e,v.RIGHT)},this.noKeyDown=!0}shutdown(e){for(var t in this.cursorKeys)this.cursorKeys[t].destroy();this.cursorKeys=void 0}destroy(e){shutdown(e)}createCursorKeys(){return this.cursorKeys}setKeyState(e,t){var i=this.cursorKeys[e];return i.enabled?(t&&(this.noKeyDown=!1),i.isDown!==t&&(x.timeStamp=Date.now(),x.keyCode=i.keyCode,t?i.onDown(x):i.onUp(x)),this):this}clearAllKeysState(){for(var e in this.noKeyDown=!0,this.cursorKeys)this.setKeyState(e,!1);return this}getKeyState(e){return this.cursorKeys[e]}get upKeyDown(){return this.cursorKeys.up.isDown}get downKeyDown(){return this.cursorKeys.down.isDown}get leftKeyDown(){return this.cursorKeys.left.isDown}get rightKeyDown(){return this.cursorKeys.right.isDown}get anyKeyDown(){return!this.noKeyDown}}var x={timeStamp:0,keyCode:0,altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,location:0},S=180/Math.PI;const C={"up&down":0,"left&right":1,"4dir":2,"8dir":3};var D={};const E=Phaser.Utils.Objects.GetValue,H=Phaser.Math.Distance.Between,P=Phaser.Math.Angle.Between;class K extends k{constructor(e,t){super(e),this.resetFromJSON(t)}resetFromJSON(e){null==this.start&&(this.start={x:0,y:0}),null==this.end&&(this.end={x:0,y:0}),this._enable=void 0,this.setEnable(E(e,"enable",!0)),this.setMode(E(e,"dir","8dir")),this.setDistanceThreshold(E(e,"forceMin",16));var t=E(e,"start.x",null),i=E(e,"start.y",null),s=E(e,"end.x",null),a=E(e,"end.y",null);return this.setVector(t,i,s,a),this}toJSON(){return{enable:this.enable,dir:this.dirMode,forceMin:this.forceMin,start:{x:this.start.x,y:this.start.y},end:{x:this.end.x,y:this.end.y}}}setMode(e){return"string"==typeof e&&(e=C[e]),this.dirMode=e,this}get enable(){return this._enable}set enable(e){if(this._enable!==e)return e||this.clearVector(),this._enable=e,this}setEnable(e){return void 0===e&&(e=!0),this.enable=e,this}toggleEnable(){return this.setEnable(!this.enable),this}setDistanceThreshold(e){return e<0&&(e=0),this.forceMin=e,this}clearVector(){return this.start.x=0,this.start.y=0,this.end.x=0,this.end.y=0,this.clearAllKeysState(),this}setVector(e,t,i,s){if(!this.enable)return this;if(null===e)return this.clearVector(),this;if(void 0===i&&(i=e,e=0,s=t,t=0),this.start.x=e,this.start.y=t,this.end.x=i,this.end.y=s,this.forceMin>0&&this.force<this.forceMin)return this.clearVector(),this;this.noKeyDown=!0;var a=function(e,t,i){switch(void 0===i?i={}:!0===i&&(i=D),i.left=!1,i.right=!1,i.up=!1,i.down=!1,e=(e+360)%360,t){case 0:e<180?i.down=!0:i.up=!0;break;case 1:e>90&&e<=270?i.left=!0:i.right=!0;break;case 2:e>45&&e<=135?i.down=!0:e>135&&e<=225?i.left=!0:e>225&&e<=315?i.up=!0:i.right=!0;break;case 3:e>22.5&&e<=67.5?(i.down=!0,i.right=!0):e>67.5&&e<=112.5?i.down=!0:e>112.5&&e<=157.5?(i.down=!0,i.left=!0):e>157.5&&e<=202.5?i.left=!0:e>202.5&&e<=247.5?(i.left=!0,i.up=!0):e>247.5&&e<=292.5?i.up=!0:e>292.5&&e<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i}(this.angle,this.dirMode,!0);for(var h in a)this.setKeyState(h,a[h]);return this}get forceX(){return this.end.x-this.start.x}get forceY(){return this.end.y-this.start.y}get force(){return H(this.start.x,this.start.y,this.end.x,this.end.y)}get rotation(){return P(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return this.rotation*S}get octant(){var e=0;return this.rightKeyDown?e=this.downKeyDown?45:0:this.downKeyDown?e=this.leftKeyDown?135:90:this.leftKeyDown?e=this.upKeyDown?225:180:this.upKeyDown&&(e=this.rightKeyDown?315:270),e}}const T={setEventEmitter(e,t){return void 0===t&&(t=Phaser.Events.EventEmitter),this._privateEE=!0===e||void 0===e,this._eventEmitter=this._privateEE?new t:e,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit(e){return this._eventEmitter&&e&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]},eventNames(){return this._eventEmitter?this._eventEmitter.eventNames.apply(this._eventEmitter,arguments):[]}};var A={};const B=Phaser.Utils.Objects.GetValue,M=Phaser.Geom.Circle,I=Phaser.Geom.Circle.Contains;class F extends K{constructor(e,t){var i=e.scene;super(i,t);var s=B(t,"eventEmitter",void 0),a=B(t,"EventEmitterClass",void 0);this.setEventEmitter(s,a),this.scene=i,this.mainCamera=i.sys.cameras.main,this.pointer=void 0,this.gameObject=e,this.radius=B(t,"radius",100),e.setInteractive(new M(e.displayOriginX,e.displayOriginY,this.radius),I),this.boot()}resetFromJSON(e){return super.resetFromJSON(e),this.pointer=void 0,this}toJSON(){var e=super.toJSON();return e.radius=this.radius,e}boot(){this.gameObject.on("pointerdown",this.onKeyDownStart,this),this.gameObject.on("pointerover",this.onKeyDownStart,this),this.scene.input.on("pointermove",this.onKeyDown,this),this.scene.input.on("pointerup",this.onKeyUp,this),this.gameObject.once("destroy",this.onParentDestroy,this)}shutdown(e){this.scene&&(this.scene.input.off("pointermove",this.onKeyDown,this),this.scene.input.off("pointerup",this.onKeyUp,this),this.destroyEventEmitter(),this.scene=void 0,this.mainCamera=void 0,this.pointer=void 0,this.gameObject=void 0,super.shutdown())}get enable(){return this._enable}set enable(e){if(this._enable!==e)return e||(this.pointer=void 0),super.enable=e,this}destroy(e){this.shutdown(e)}onParentDestroy(e,t){this.destroy(t)}onKeyDownStart(e){e.isDown&&void 0===this.pointer&&(this.pointer=e,this.onKeyDown(e),this.emit("pointerdown",e))}onKeyDown(e){if(this.pointer===e){var t=function(e,t,i){var s=e.camera;return s?(void 0===i?i={}:!0===i&&(i=A),s===t?(i.x=e.worldX,i.y=e.worldY):s.getWorldPoint(e.x,e.y,i),i):null}(e,this.mainCamera,!0);if(t){var i=e.camera,s=this.gameObject,a=s.x,h=s.y;0===s.scrollFactorX&&(a+=i.scrollX),0===s.scrollFactorY&&(h+=i.scrollY),this.setVector(a,h,t.x,t.y),this.end.x=t.x,this.end.y=t.y,this.emit("update")}}}onKeyUp(e){this.pointer===e&&(this.pointer=void 0,this.clearVector(),this.emit("update"),this.emit("pointerup",e))}forceUpdate(){var e=this.pointer;return e&&e.isDown?(this.onKeyDown(e),this):this}}Object.assign(F.prototype,T);const O=Phaser.Utils.Objects.GetValue;class W{constructor(e,t){void 0===t&&(t={});var i=O(t,"eventEmitter",void 0),s=O(t,"EventEmitterClass",void 0);this.setEventEmitter(i,s),t.eventEmitter=this.getEventEmitter(),this.scene=e,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0,this.setRadius(O(t,"radius",100)),this.addBase(O(t,"base",void 0),t),this.addThumb(O(t,"thumb",void 0));var a=O(t,"x",0),h=O(t,"y",0);this.base.setPosition(a,h),this.thumb.setPosition(a,h),O(t,"fixed",!0)&&this.setScrollFactor(0),this.boot()}destroy(){this.destroyEventEmitter(),this.base.destroy(),this.thumb.destroy(),this.scene=void 0,this.base=void 0,this.thumb=void 0,this.touchCursor=void 0}createCursorKeys(){return this.touchCursor.createCursorKeys()}get forceX(){return this.touchCursor.forceX}get forceY(){return this.touchCursor.forceY}get force(){return this.touchCursor.force}get rotation(){return this.touchCursor.rotation}get angle(){return this.touchCursor.angle}get up(){return this.touchCursor.upKeyDown}get down(){return this.touchCursor.downKeyDown}get left(){return this.touchCursor.leftKeyDown}get right(){return this.touchCursor.rightKeyDown}get noKey(){return this.touchCursor.noKeyDown}get pointerX(){return this.touchCursor.end.x}get pointerY(){return this.touchCursor.end.y}get pointer(){return this.touchCursor.pointer}setPosition(e,t){return this.x===e&&this.y===t||(this.x=e,this.y=t,this.forceUpdateThumb()),this}set x(e){this.x!==e&&(this.base.x=e,this.thumb.x=e)}set y(e){this.y!==e&&(this.base.y=e,this.thumb.y=e)}get x(){return this.base.x}get y(){return this.base.y}setVisible(e){return this.visible=e,this}toggleVisible(){return this.visible=!this.visible,this}get visible(){return this.base.visible}set visible(e){this.base.visible=e,this.thumb.visible=e,this.enable=e}get enable(){return this.touchCursor.enable}set enable(e){this.touchCursor.setEnable(e)}setEnable(e){return void 0===e&&(e=!0),this.enable=e,this}toggleEnable(){return this.setEnable(!this.enable),this}setRadius(e){return this.radius=e,this}addBase(e,t){return this.base&&this.base.destroy(),void 0===e&&(e=this.scene.add.circle(0,0,this.radius).setStrokeStyle(3,255)),void 0===t&&(t={}),t.eventEmitter=this.getEventEmitter(),this.touchCursor=new F(e,t),this.base=e,this}addThumb(e){return this.thumb&&this.thumb.destroy(),void 0===e&&(e=this.scene.add.circle(0,0,40).setStrokeStyle(3,65280)),this.thumb=e,this}setScrollFactor(e){return this.base.setScrollFactor(e),this.thumb.setScrollFactor(e),this}boot(){this.on("update",this.update,this)}update(){var e,t,i=this.touchCursor,s=i.dirMode;if(i.anyKeyDown)if(i.force>this.radius){var a=i.rotation;e=0!==s?Math.cos(a)*this.radius:0,t=1!==s?Math.sin(a)*this.radius:0}else e=0!==s?i.forceX:0,t=1!==s?i.forceY:0;else e=0,t=0;return this.thumb.x=this.base.x+e,this.thumb.y=this.base.y+t,this}forceUpdateThumb(){return this.touchCursor.forceUpdate(),this}}Object.assign(W.prototype,T);class R extends Phaser.Plugins.BasePlugin{constructor(e){super(e)}start(){this.game.events.on("destroy",this.destroy,this)}add(e,t){return new W(e,t)}addVectorToCursorKeys(e){return new K(void 0,e)}}const X={type:Phaser.AUTO,width:400,height:300,parent:"game-container",fullscreenTarget:"game-container",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},pixelArt:!0,physics:{default:"arcade",arcade:{gravity:{y:500}}},scene:[s,c,p,u,y,g,f,b],plugins:{global:[{key:"rexVirtualJoystick",plugin:R,start:!0}]},input:{activePointers:3},fps:{target:60}};new Phaser.Game(X);
